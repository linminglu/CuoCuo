{"version":3,"sources":["../../../../../../assets/mahjong/script/ui/assets/mahjong/script/ui/mjChatUI.js"],"names":["log","cc","GameDefine","require","mjNetMgr","mjDataMgr","gameManager","Class","extends","Component","properties","btnVoiceN","Node","btnChatN","interactP","Prefab","chatP","playerDetailP","popWindowN","playerMap","onLoad","initMessage","initPlayerDetail","start","isAppleVer","fun","gameCfg","releaseType","gameConst","apple","isReplay","isReplayPai","active","sys","isNative","event","add","showPlayerInfo","bind","playerChat","showPlayerVoice","getIns","addChatNet","KEYS","CHAT","cleanMessage","remove","rmNet","update","dt","onDestroy","pData","detailN","instantiate","playerData","d","deskType","pos","data","name","showName","id","UserId","url","Icon","addr","Address","locdesc","isNoLocation","isSelf","DESKPOS_TYPE","XIA","selfUid","get","UID","curUid","getComponent","show","showPlayerMap","PlayerDetailPos","setPosition","addChild","posList","SHANG","p","ZUO","YOU","chatType","showInteract","player","getplayerByUserID","from","showChat","onBtnChatClicked","playEffect","sPlayer","ePlayer","to","interactN","getInteractPos","mapN","PLAYERS"],"mappings":"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","file":"mjChatUI.js","sourceRoot":"../../../../../../assets/mahjong/script/ui","sourcesContent":["var log             = cc.log;\nvar GameDefine      = require(\"mjGameDefine\");\nvar mjNetMgr        = require(\"mjNetMgr\");\nvar mjDataMgr       = require(\"mjDataMgr\");\nvar gameManager     = require(\"mjGameManager\");\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n       btnVoiceN    : cc.Node,\n       btnChatN     : cc.Node,\n       interactP    : cc.Prefab,\n       chatP        : cc.Prefab,\n       playerDetailP: cc.Prefab,\n       popWindowN   : cc.Node,\n       playerMap  : cc.Prefab,\n\n    },\n\n    // use this for initialization\n    onLoad: function () {\n        this.initMessage();\n        this.initPlayerDetail();\n    },\n\n    start(){\n        var isAppleVer = (fun.gameCfg.releaseType === gameConst.releaseType.apple);\n        var isReplay   = require(\"mjReplayMgr\").isReplayPai();\n        this.btnVoiceN.active = cc.sys.isNative && !isReplay && !isAppleVer;//just phone can use \n        this.btnChatN.active  = !isReplay && !isAppleVer;\n    },\n\n    initMessage : function(){\n        fun.event.add(\"mjPlayerDetail\", \"mjPlayerDetail\", this.showPlayerInfo.bind(this))\n        fun.event.add(\"mjRoomChat\", \"RoomChat\", this.playerChat.bind(this))\n        fun.event.add(\"mjRoomChatV\", \"RoomChatVoice\", this.showPlayerVoice.bind(this));\n        mjNetMgr.getIns().addChatNet(mjNetMgr.KEYS.CHAT, this);\n    },\n\n    cleanMessage : function(){\n        fun.event.remove(\"mjPlayerDetail\");\n        fun.event.remove(\"mjRoomChat\");\n        fun.event.remove(\"mjRoomChatV\");\n        mjNetMgr.getIns().rmNet(mjNetMgr.KEYS.CHAT);\n    },\n\n    update : function(dt){\n    },\n\n    onDestroy : function(){\n        this.cleanMessage();\n    },\n\n    showPlayerInfo(pData){\n        var detailN       = cc.instantiate(this.playerDetailP);\n        var playerData    = pData.d;\n        var deskType      = pData.pos\n        var data          = {name : playerData.showName, id : \"ID:\"+playerData.UserId, url : playerData.Icon};\n        data.addr         = (playerData.Address) ? playerData.Address.locdesc : \"未开启定位\";//\"离你999.2km\";\n        data.isNoLocation = false;\n        data.isSelf       = deskType  == GameDefine.DESKPOS_TYPE.XIA;\n        data.selfUid      = mjDataMgr.get(mjDataMgr.KEYS.UID);\n        data.curUid       = playerData.UserId;\n        detailN.getComponent(\"playerDetailUI\").show(data, this.showPlayerMap.bind(this));\n        cc.log(\"this.PlayerDetailPos[deskType]\", this.PlayerDetailPos[deskType]);\n        detailN.setPosition(this.PlayerDetailPos[deskType]);\n        this.popWindowN.addChild(detailN);\n    },\n\n    initPlayerDetail : function(){\n        var deskType            = GameDefine.DESKPOS_TYPE;\n        var posList             = {};\n        posList[deskType.SHANG] = cc.p(135, 180);\n        posList[deskType.ZUO]   = cc.p(-360, 120);\n        posList[deskType.YOU]   = cc.p(360, 135);\n        posList[deskType.XIA]   = cc.p(-360, -135);\n        this.PlayerDetailPos    = posList;\n    },\n\n    playerChat(data){\n        if(data.chatType == \"interact\"){\n            this.showInteract(data);\n        }else {\n            if(data.chatType != \"voice\"){\n                var player = gameManager.getplayerByUserID(data.from);\n                player.showChat(data);\n            }\n        }\n    },\n\n    showPlayerVoice(data){\n        var player = gameManager.getplayerByUserID(data.from);\n        player.showChat(data);\n    },\n\n\n    onBtnChatClicked(){\n        require(\"Audio\").playEffect(\"hall\", \"button_nomal.mp3\");\n        this.popWindowN.addChild( cc.instantiate(this.chatP) );\n    },\n\n\n    showInteract(data){\n        var sPlayer   = gameManager.getplayerByUserID(data.from);\n        var ePlayer   = gameManager.getplayerByUserID(data.to);\n        var interactN = cc.instantiate(this.interactP);\n        this.popWindowN.addChild(interactN);\n        interactN.getComponent(\"interact\").show(data, sPlayer.getInteractPos(), ePlayer.getInteractPos());\n    },\n\n    showPlayerMap(){\n        var mapN = cc.instantiate(this.playerMap);\n        this.popWindowN.addChild(mapN)\n        mapN.getComponent(\"playerMap\").show(mjDataMgr.get(mjDataMgr.KEYS.PLAYERS));\n    },\n})\n"]}