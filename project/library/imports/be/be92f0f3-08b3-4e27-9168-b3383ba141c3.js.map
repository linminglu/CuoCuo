{"version":3,"sources":["../../../../../../assets/mahjong/script/ui/assets/mahjong/script/ui/mjInteractUI.js"],"names":["log","cc","Class","extends","Component","properties","onLoad","show","idx","chatData","data","split","endIdx","startPlayer","gameManager","playerList","endPlayer","startWorldPos","getInteractPos","endWorldPos","startLocalPos","node","convertToNodeSpaceAR","endLocalPos","interactData","getInteractData","animaNode","getChildByName","nodeName","active","setPosition","spAnim","getComponent","sp","Skeleton","setAnimation","animaName","self","moveTime","pDistance","moveAction","sequence","moveTo","callFunc","onMoveEnd","runAction","id","interactList","GameDefine","CHATINTERACT","k","endFunc","removeFromParent","setCompleteListener"],"mappings":";;;;;;AAAA;AACA;AACA;AACA;AACA,IAAIA,MAAgBC,GAAGD,GAAvB;;AAGAC,GAAGC,KAAH,CAAS;AACLC,aAASF,GAAGG,SADP;;AAGLC,gBAAY,EAHP;;AAOL;AACAC,YAAQ,kBAAY,CACnB,CATI;;AAWLC,UAAO,cAASC,GAAT,EAAcC,QAAd,EAAuB;AAC1B,YAAIC,OAAgBD,SAASE,KAAT,CAAe,KAAf,CAApB;AACA,YAAIC,SAAgBF,KAAK,CAAL,CAApB;AACA,YAAIG,cAAgBC,YAAYC,UAAZ,CAAuBP,GAAvB,CAApB;AACA,YAAIQ,YAAgBF,YAAYC,UAAZ,CAAuBH,MAAvB,CAApB;;AAEA,YAAIK,gBAAgBJ,YAAYK,cAAZ,EAApB;AACA,YAAIC,cAAgBH,UAAUE,cAAV,EAApB;;AAEA,YAAIE,gBAAgB,KAAKC,IAAL,CAAUC,oBAAV,CAA+BL,aAA/B,CAApB;AACA,YAAIM,cAAgB,KAAKF,IAAL,CAAUC,oBAAV,CAA+BH,WAA/B,CAApB;;AAEA,YAAIK,eAAgB,KAAKC,eAAL,CAAqBf,KAAK,CAAL,CAArB,CAApB;AACA,aAAKgB,SAAL,GAAwB,KAAKL,IAAL,CAAUM,cAAV,CAAyBH,aAAaI,QAAtC,CAAxB;AACA,aAAKF,SAAL,CAAeG,MAAf,GAAwB,IAAxB;AACA,aAAKH,SAAL,CAAeI,WAAf,CAA2BV,aAA3B;AACA,aAAKM,SAAL,CAAeC,cAAf,CAA8B,SAA9B,EAAyCE,MAAzC,GAAkD,IAAlD;AACA,aAAKE,MAAL,GAAwB,KAAKL,SAAL,CAAeC,cAAf,CAA8B,SAA9B,EAAyCK,YAAzC,CAAsDC,GAAGC,QAAzD,CAAxB;AACA;AACA;AACA,aAAKH,MAAL,CAAYI,YAAZ,CAAyB,CAAzB,EAA4BX,aAAaY,SAAb,GAAwB,MAApD,EAA4D,IAA5D;;AAEA,YAAIC,OAAgB,IAApB;AACA,aAAKb,YAAL,GAAoBA,YAApB;AACA,YAAIc,WAAgBrC,GAAGsC,SAAH,CAAanB,aAAb,EAA4BG,WAA5B,IAAyC,IAA7D;AACA,YAAIiB,aAAgBvC,GAAGwC,QAAH,CAAYxC,GAAGyC,MAAH,CAAUJ,QAAV,EAAoBf,WAApB,CAAZ,EAA8CtB,GAAG0C,QAAH,CAAY,YAAU;AACpFN,iBAAKO,SAAL;AACH,SAFiE,CAA9C,CAApB;AAGA,aAAKlB,SAAL,CAAemB,SAAf,CAAyBL,UAAzB;AACH,KAxCI;;AA0CLf,qBAAkB,yBAASqB,EAAT,EAAY;AAC1B,YAAIpC,IAAJ;AACA,YAAIqC,eAAeC,WAAWC,YAA9B;AACA,aAAI,IAAIC,CAAR,IAAaH,YAAb,EAA0B;AACtB,gBAAGA,aAAaG,CAAb,EAAgBJ,EAAhB,IAAsBA,EAAzB,EAA4B;AACxBpC,uBAAOqC,aAAaG,CAAb,CAAP;AACH;AACJ;AACD,eAAOxC,IAAP;AACH,KAnDI;;AAqDLkC,eAAY,qBAAU;AAClB,YAAIP,OAAO,IAAX;AACA,YAAIc,UAAU,SAAVA,OAAU,GAAU;AACpBd,iBAAKhB,IAAL,CAAU+B,gBAAV;AACH,SAFD;AAGA,aAAKrB,MAAL,CAAYsB,mBAAZ,CAAgCF,OAAhC;AACA,YAAIf,YAAY,KAAKZ,YAAL,CAAkBY,SAAlC;AACA;AACA;AACA,aAAKL,MAAL,CAAYI,YAAZ,CAAyB,CAAzB,EAA4BC,YAAW,MAAvC,EAA+C,KAA/C;AACH;;AAKD;AACA;;AAEA;AAvEK,CAAT","file":"mjInteractUI.js","sourceRoot":"../../../../../../assets/mahjong/script/ui","sourcesContent":["// var gameManager   = require(\"mjGameManager\");\n// var GameDefine    = require(\"mjGameDefine\");\n////var Audio.         = require(\"Audio\");\n// var utils         = require(\"utils\");\nvar log           = cc.log;\n\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        \n    },\n\n    // use this for initialization\n    onLoad: function () {\n    },\n\n    show : function(idx, chatData){\n        var data          = chatData.split(\"|||\");\n        var endIdx        = data[0];\n        var startPlayer   = gameManager.playerList[idx];\n        var endPlayer     = gameManager.playerList[endIdx];\n\n        var startWorldPos = startPlayer.getInteractPos();\n        var endWorldPos   = endPlayer.getInteractPos();\n\n        var startLocalPos = this.node.convertToNodeSpaceAR(startWorldPos);\n        var endLocalPos   = this.node.convertToNodeSpaceAR(endWorldPos);\n\n        var interactData  = this.getInteractData(data[1]);\n        this.animaNode        = this.node.getChildByName(interactData.nodeName);\n        this.animaNode.active = true;\n        this.animaNode.setPosition(startLocalPos)\n        this.animaNode.getChildByName(\"content\").active = true;\n        this.spAnim           = this.animaNode.getChildByName(\"content\").getComponent(sp.Skeleton)\n        //Audio.playSystemSound(\"hd_feixing.mp3\", false);\n        // //Audio.playSystemSound(\"hd_Jidan\", false);\n        this.spAnim.setAnimation(0, interactData.animaName +\"_fei\", true);\n        \n        var self          = this;\n        this.interactData = interactData;\n        var moveTime      = cc.pDistance(startLocalPos, endLocalPos)/1500;\n        var moveAction    = cc.sequence(cc.moveTo(moveTime, endLocalPos), cc.callFunc(function(){\n            self.onMoveEnd();\n        }))\n        this.animaNode.runAction(moveAction);\n    },\n\n    getInteractData : function(id){\n        var data;\n        var interactList = GameDefine.CHATINTERACT;\n        for(let k in interactList){\n            if(interactList[k].id == id){\n                data = interactList[k];\n            }\n        }\n        return data;\n    },\n\n    onMoveEnd : function(){\n        var self = this;\n        var endFunc = function(){\n            self.node.removeFromParent();\n        }\n        this.spAnim.setCompleteListener(endFunc);\n        var animaName = this.interactData.animaName;\n        //Audio.playSystemSound(\"hd_\"+animaName+\".mp3\", false);\n        // //Audio.playSystemSound(\"hd_Jidan\", false);\n        this.spAnim.setAnimation(0, animaName +\"_dao\", false);\n    },\n\n\n\n\n    // called every frame, uncomment this function to activate update callback\n    // update: function (dt) {\n\n    // },\n});\n"]}