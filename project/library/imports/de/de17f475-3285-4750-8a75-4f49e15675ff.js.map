{"version":3,"sources":["../../../../../../assets/hall/script/zhanji/assets/hall/script/zhanji/zhanjiScv.js"],"names":["eventName","cc","Class","extends","Component","properties","_hasInit","default","_lastStart","_enableCheck","gameType","type","gameConst","universal","spacing","scrollView","ScrollView","itemTemplate","Node","zhanjiDetailPre","Prefab","enableCheck","flag","onLoad","_content","content","_totalCount","onDestroy","fun","event","remove","init","getSum","add","onReplayInfoIn","bind","onEnable","log","node","parent","name","net","pSend","GameType","Start","data","initWithData","addItems","accounts","lastStart","forEach","value","item","instantiate","getComponent","y","height","x","createdAt","once","onBottomCb","newHeight"],"mappings":"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","file":"zhanjiScv.js","sourceRoot":"../../../../../../assets/hall/script/zhanji","sourcesContent":["let eventName = '';\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        _hasInit: {\n            default: false,\n        },\n\n        _lastStart: {\n            default: false,\n        },\n\n        _enableCheck: {\n            default: false,\n        },\n\n        gameType: {\n            type: gameConst.gameType,\n            default: gameConst.gameType.universal,\n        },\n\n        spacing: {\n            default: 0,\n        },\n\n        scrollView: {\n            type: cc.ScrollView,\n            default: null,\n        },\n\n        itemTemplate: {\n            default: null,\n            type: cc.Node,\n        },\n\n        zhanjiDetailPre: {\n            type: cc.Prefab,\n            default: null,\n        },\n    },\n\n    enableCheck (flag) {\n        this._enableCheck = flag;\n    },\n\n    onLoad () {\n        this._content = this.scrollView.content;\n        this._totalCount = 0;\n    },\n\n    onDestroy () {\n        fun.event.remove(eventName);\n    },\n\n    init() {\n        eventName = 'zhanjiScv' +fun.event.getSum();\n        fun.event.add(eventName, 'ReplayInfo', this.onReplayInfoIn.bind(this));\n    },\n\n    onReplayInfoIn() {\n        this._enableCheck = false;\n    },\n\n    onEnable () {\n        if (this._hasInit || !this._enableCheck) {\n            return;\n        }\n         cc.log(\"--onEnable-\", this.node.parent.parent.name, this._enableCheck);\n        fun.net.pSend('StandingBrief', {GameType: this.gameType, Start: 0}, function(data) {\n            this.initWithData(data);\n        }.bind(this));\n    },\n\n    initWithData (data) {\n        this._hasInit = true;\n        this.addItems(data.accounts);\n    },\n\n    addItems(data = []) {\n        let lastStart = false;\n        data.forEach(function(value) {\n            let item = cc.instantiate(this.itemTemplate);\n            item.parent = this._content;\n            value.gameType = this.gameType;\n            item.getComponent('zhanjiItem').init(value);\n            item.y = -item.height * (0.5 + this._totalCount) - this.spacing * this._totalCount;\n            item.x = 0;\n            this._totalCount++;\n            if (!lastStart || (lastStart > value.createdAt)) {\n                lastStart = value.createdAt;\n            }\n        }.bind(this));\n        if (lastStart && lastStart !== this._lastStart) {\n            this._lastStart = lastStart;\n            this.node.once('scroll-to-bottom', this.onBottomCb, this);\n        }\n        const newHeight = this._totalCount * (this.itemTemplate.height + this.spacing) + this.spacing;\n        if (newHeight > this._content.height) {\n            this._content.height = newHeight;\n        }\n    },\n\n    onBottomCb() {\n        cc.log(\"--onBottomCb-\");\n        fun.net.pSend('StandingBrief', {GameType: this.gameType, Start: this._lastStart}, function(data) {\n            this.initWithData(data);\n        }.bind(this));\n    }\n});\n"]}