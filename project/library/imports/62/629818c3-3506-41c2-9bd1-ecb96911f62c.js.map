{"version":3,"sources":["../../../../../../../assets/mahjong/script/wahua/desk/assets/mahjong/script/wahua/desk/gameMgrWahua.js"],"names":["WhUtils","require","cc","Class","extends","Component","properties","btnExit","type","Node","default","btnReady","btnInvite","paiMianAltas","SpriteAtlas","onLoad","fun","event","dispatch","flag","net","setGameMsgCfg","_userId","db","getData","UserId","roomInfo","_gameStatu","roomRule","gameStatu","_isRoomOwner","toString","roomOwner","_playerNum","playerNum","_seat","Array","_seatDir","on","onBtnExitClick","onBtnReadyClick","onBtnInviteClick","registerListener","start","reconnet","pListen","onEnterRoomIn","bind","onOffLineIn","onOnLineIn","listen","onDisbandRoomIn","onReadyIn","onReadyNextIn","onDisbandRoomVoteIn","onDisbandRoomResultIn","onBankerIn","onRockCardIn","onUserRefreshIn","onNoneOpsIn","onStartGameIn","onPlayCardIn","onDrawCardIn","onOpsAcceptIn","onRepairCardIn","onOneAccountIn","onQuitRoomIn","onAllAccountIn","add","updateSeats","removeListener","rmPListen","rmListen","remove","onDestroy","p","ui","node","getChildByName","getComponent","pos","id","data","userId","undefined","log","getSeatByUserId","i","length","userMap","selfReadyState","currentState","setReadyState","nowZhuangjia","setJiaWeiShow","rollChessDice","showYaoZhang","alreadyChess","showCardById","yaozhang","isReconnet","yzNode","yz","getCardById","yzCard","Sprite","spriteFrame","getSpriteFrame","active","cards","seat","setCardShow","tSeat","tPos","newSeat","curPos","dir","cha","setDirect","send","rsp","exitRoom","applyStatu","returnStatu","ready","showReady","key","userOneMap","setData","Zhuangjia","szCallback","szCard","szPoint","getSaiziPointByCard","point","callback","parseInt","outLine","userInfo","RoomId","director","loadScene"],"mappings":"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","file":"gameMgrWahua.js","sourceRoot":"../../../../../../../assets/mahjong/script/wahua/desk","sourcesContent":["const WhUtils = require('whUtils');\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        btnExit: {\n            type: cc.Node,\n            default: null,\n        },\n\n        btnReady: {\n            type: cc.Node,\n            default: null,\n        },\n\n        btnInvite: {\n            type: cc.Node,\n            default: null,\n        },\n\n        paiMianAltas: {\n            type: cc.SpriteAtlas,\n            default: null,\n        },\n    },\n\n    onLoad () {\n        fun.event.dispatch('Zhuanquan', {flag: false});\n        fun.net.setGameMsgCfg(require('WahuaCfg'));\n        this._userId = fun.db.getData('UserInfo').UserId;\n        let roomInfo = fun.db.getData('RoomInfo');\n        this._gameStatu = roomInfo.roomRule.gameStatu;\n        this._isRoomOwner = (this._userId.toString() === roomInfo.roomRule.roomOwner);\n        this._playerNum = roomInfo.roomRule.playerNum;\n        this._seat = new Array();\n        this._seatDir = ['xia', 'you', 'shang', 'zuo'];\n\n        this.btnExit.on('click', this.onBtnExitClick, this);\n        this.btnReady.on('click', this.onBtnReadyClick, this);\n        this.btnInvite.on('click', this.onBtnInviteClick, this);\n        this.registerListener();\n    },\n\n    start() {\n        this.reconnet();\n\n    },\n\n    registerListener() {\n        fun.net.pListen('EnterRoom', this.onEnterRoomIn.bind(this));\n        fun.net.pListen('OffLine', this.onOffLineIn.bind(this));\n        fun.net.pListen('OnLine', this.onOnLineIn.bind(this));\n        fun.net.listen('DisbandRoom', this.onDisbandRoomIn.bind(this));\n        fun.net.listen('Ready', this.onReadyIn.bind(this));\n        fun.net.listen('ReadyNext', this.onReadyNextIn.bind(this));\n        fun.net.listen('DisbandRoomVote', this.onDisbandRoomVoteIn.bind(this));\n        fun.net.listen('DisbandRoomResult', this.onDisbandRoomResultIn.bind(this));\n        fun.net.listen('Banker', this.onBankerIn.bind(this));\n        fun.net.listen('RockCard', this.onRockCardIn.bind(this));\n        fun.net.listen('UserRefresh', this.onUserRefreshIn.bind(this));\n        fun.net.listen('NoneOps', this.onNoneOpsIn.bind(this));\n        fun.net.listen('StartGame', this.onStartGameIn.bind(this));\n        fun.net.listen('PlayCard', this.onPlayCardIn.bind(this));\n        fun.net.listen('DrawCard', this.onDrawCardIn.bind(this));\n        fun.net.listen('OpsAccept', this.onOpsAcceptIn.bind(this));\n        fun.net.listen('RepairCard', this.onRepairCardIn.bind(this));\n        fun.net.listen('OneAccount', this.onOneAccountIn.bind(this));\n        fun.net.listen('QuitRoom', this.onQuitRoomIn.bind(this));\n        fun.net.listen('AllAccount', this.onAllAccountIn.bind(this));\n\n        fun.event.add('gameMgrWahuaInitCompleted', 'wahuaInitCompleted', this.updateSeats.bind(this));\n        fun.event.add('gameMgrWahuaQuitFromSetting', 'wahuaQuitFromSetting', this.onBtnExitClick.bind(this));\n    },\n    removeListener() {\n        fun.net.rmPListen('EnterRoom');\n        fun.net.rmPListen('OffLine');\n        fun.net.rmPListen('OnLine');\n        fun.net.rmListen('DisbandRoom');\n        fun.net.rmListen('Ready');\n        fun.net.rmListen('ReadyNext');\n        fun.net.rmListen('DisbandRoomVote');\n        fun.net.rmListen('DisbandRoomResult');\n        fun.net.rmListen('Banker');\n        fun.net.rmListen('RockCard');\n        fun.net.rmListen('UserRefresh');\n        fun.net.rmListen('NoneOps');\n        fun.net.rmListen('StartGame');\n        fun.net.rmListen('PlayCard');\n        fun.net.rmListen('DrawCard');\n        fun.net.rmListen('OpsAccept');\n        fun.net.rmListen('RepairCard');\n        fun.net.rmListen('OneAccount');\n        fun.net.rmListen('QuitRoom');\n        fun.net.rmListen('AllAccount');\n\n        fun.event.remove('gameMgrWahuaInitCompleted');\n        fun.event.remove('gameMgrWahuaQuitFromSetting');\n    },\n\n    onDestroy() {\n        this.removeListener();\n        this._seat = [];\n        this._seatDir = [];\n    },\n\n    updateSeats(p) {\n        if (!p && p !== 0) return;\n        this._seat[p] = {};\n        this._seat[p].ui = this.node.getChildByName(this._seatDir[p]).getComponent('playerUiWahua');\n        this._seat[p].pos = p;\n        this._seat[p].id = this._seat[p].ui.data ? this._seat[p].ui.data.userId : undefined;\n        cc.log('--- this._seat: ', this._seat);\n    },\n\n    getSeatByUserId(id) {\n        for (let i=0; i<this._seat.length; ++i) {\n            if (this._seat[i] && this._seat[i].id && this._seat[i].id === id) {\n                return this._seat[i];\n            }\n        }\n    },\n\n    reconnet() {\n        let roomInfo = fun.db.getData('RoomInfo');\n        if(!roomInfo.userMap) return;\n        let roomRule = roomInfo.roomRule;\n        let userMap = roomInfo.userMap;\n        let selfReadyState = userMap[this._userId].currentState;\n        this.setReadyState(selfReadyState === 0 ? true : false);\n        if (roomRule.nowZhuangjia) {\n            this.setJiaWeiShow(roomRule.nowZhuangjia);\n        }\n        if (roomRule.rollChessDice) {\n            this.showYaoZhang(roomRule.rollChessDice, true);\n        }\n        for (let id in userMap) {\n            if (!userMap[id].alreadyChess) return;\n            this.showCardById(id, userMap[id].alreadyChess);\n        }\n    },\n\n    showYaoZhang(yaozhang, isReconnet) {\n        let yzNode = this.node.getChildByName('yaozhang');\n        for (let i=0; i<yaozhang.length; ++i) {\n            let yz = WhUtils.getCardById(yaozhang[i]);\n            let yzCard = yzNode.getChildByName('card'+(i+1)).getComponent(cc.Sprite);\n            yzCard.spriteFrame = this.paiMianAltas.getSpriteFrame(yz);\n        }\n        if (isReconnet) {\n            yzNode.active = true;\n        }\n    },\n\n    showCardById(id, cards) {\n        let seat = this.getSeatByUserId(id);\n        if(!seat) return;\n        seat.ui.setCardShow(cards);\n    },\n\n    setReadyState(flag) {\n        this.btnReady.active = flag;\n        if (this._gameStatu === 1) return;\n        this.btnInvite.active = false;\n        this.btnExit.active = false;\n    },\n\n    setJiaWeiShow(id) {\n        this.node.getChildByName('roomDescScrollView').active = false;\n        let tSeat = this.getSeatByUserId(id);\n        let tPos = tSeat.pos;\n        let newSeat = new Array(); // 0-天家 1-地家 2-银牌 3-长三\n        for (let i=0; i<this._seat.length; ++i) {\n            if (this._seat[i]) {\n                let curPos = this._seat[i].pos;\n                let dir = 0;\n                let cha = curPos - tPos;\n                if (cha === 1 || cha === -3) {\n                    dir = 1;\n                } else if (cha === 2 || cha === -2) {\n                    dir = 2;\n                } else if (cha === 3 || cha === -1) {\n                    dir = 3;\n                } else {\n                    dir = 0;\n                }\n                newSeat[dir] = this._seat[i];\n            }\n        }\n        for (let dir=0; dir<newSeat.length; ++dir) {\n            if (newSeat[dir]) {\n                newSeat[dir].ui.setDirect(dir);\n            }\n        }\n    },\n\n    onBtnExitClick() {\n        if (this._gameStatu === 1) {\n            if (this._isRoomOwner) {\n                fun.net.send('DisbandRoom', {}, function(rsp) {\n                    cc.log('DisbandRoom-----------', rsp);\n                    this.exitRoom();\n                }.bind(this));\n            } else {\n                fun.net.send('QuitRoom', {}, function(rsp) {\n                    cc.log('QuitRoom---------', rsp);\n                    this.exitRoom();\n                }.bind(this));\n            }\n        } else {\n            fun.net.send('DisbandRoomVote', {applyStatu: 0}, function(rsp) {\n                cc.log('DisbandRoomVote--------', rsp);\n                this.exitRoom();\n            }.bind(this));\n        }\n    },\n\n    onBtnReadyClick() {\n        fun.net.send('Ready', {}, function(rsp) {\n            if (rsp.returnStatu && rsp.returnStatu === 1) {\n                let seat = this.getSeatByUserId(rsp.ready);\n                if (!seat) return;\n                seat.ui.showReady(true);\n                this.setReadyState(false);\n            }\n        }.bind(this));\n    },\n    onBtnInviteClick() {\n        cc.log('--- invite ---')\n    },\n\n    onEnterRoomIn(data) {\n        let roomInfo = fun.db.getData('RoomInfo');\n        if (!roomInfo.userMap) {\n            roomInfo.userMap = {};\n        }\n        for (const key in data.userOneMap) {\n            if (key === 'userId') {\n                roomInfo.userMap[data.userOneMap.userId] = data.userOneMap;\n                fun.db.setData('RoomInfo', roomInfo);\n                return;\n            }\n        }\n    },\n\n    onReadyIn(data) {\n        cc.log('onReadyIn--------', data);\n        if (!data.ready) return;\n        let seat = this.getSeatByUserId(data.ready);\n        if (!seat) return;\n        seat.ui.showReady(true);\n    },\n\n    onReadyNextIn(data) {\n        cc.log('onReadyNextIn--------', data);\n        this.setReadyState(true);\n    },\n\n    onBankerIn(data) {\n        cc.log('onBankerIn--------', data);\n        this._gameStatu = 2;\n        this.setJiaWeiShow(data.Zhuangjia);\n        this.setReadyState(false);\n        for(let i=0; i<this._seat.length; ++i){\n            if (this._seat[i]) {\n                this._seat[i].ui.showReady(false);\n            }\n        }\n    },\n\n    onRockCardIn(data) {\n        cc.log('onRockCardIn--------', data);\n        let yzNode = this.node.getChildByName('yaozhang');\n        this.showYaoZhang(data.rollChessDice);\n        let szCallback = function(){\n            yzNode.active = true;\n        };\n        let szCard = WhUtils.getCardById(data.rollChessDice[0]);\n        let szPoint = WhUtils.getSaiziPointByCard(szCard);\n        fun.event.dispatch('wahuaSaiziEnd', {point: szPoint, callback: szCallback});\n    },\n\n    onUserRefreshIn(data) {\n        cc.log('onUserRefreshIn--------', data);\n    },\n\n    onNoneOpsIn(data) {\n        cc.log('onNoneOpsIn--------', data);\n    },\n\n    onStartGameIn(data) {\n        cc.log('onStartGameIn--------', data);\n        this.showCardById(this._userId, data.alreadyChess);\n    },\n\n    onPlayCardIn(data) {\n        cc.log('onPlayCardIn--------', data);\n    },\n\n    onDrawCardIn(data) {\n        cc.log('onDrawCardIn--------', data);\n    },\n\n    onOpsAcceptIn(data) {\n        cc.log('onOpsAcceptIn--------', data);\n    },\n\n    onRepairCardIn(data) {\n        cc.log('onRepairCardIn--------', data);\n    },\n\n    onOneAccountIn(data) {\n        cc.log('onOneAccountIn--------', data);\n    },\n\n    onAllAccountIn(data) {\n        cc.log('onAllAccountIn--------', data);\n    },\n\n    onDisbandRoomIn(data) {\n        cc.log('onDisbandRoomIn--------', data);\n        this.exitRoom();\n    },\n\n    onQuitRoomIn(data) {\n        let roomInfo = fun.db.getData('RoomInfo');\n        delete roomInfo.userMap[data.userId];\n        fun.db.setData('RoomInfo', roomInfo);\n    },\n\n    onDisbandRoomVoteIn(data) {\n        cc.log('onDisbandRoomVoteIn--------', data);\n    },\n\n    onDisbandRoomResultIn(data) {\n        cc.log(\"DisbandRoomResult---------------\", data);\n    },\n\n    onOffLineIn(data) {\n        fun.event.dispatch('OffLineState', {flag: true, userId: parseInt(data.outLine)});\n    },\n\n    onOnLineIn(data) {\n        fun.event.dispatch('OffLineState', {flag: false, userId: parseInt(data.userId)});\n    },\n\n    exitRoom() {\n        let userInfo = fun.db.getData('UserInfo');\n        userInfo.RoomId = 0;\n        fun.db.setData('UserInfo', userInfo);\n        cc.director.loadScene('hall');\n    },\n\n});\n"]}