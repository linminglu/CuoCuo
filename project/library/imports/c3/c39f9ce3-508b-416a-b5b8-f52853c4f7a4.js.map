{"version":3,"sources":["../../../../../../assets/hall/script/hall/assets/hall/script/hall/hallGangGao.js"],"names":["cc","Class","extends","Component","properties","mask","type","Node","default","content","contentLabel","Label","normalColor","Color","WHITE","superColor","onLoad","minx","x","width","startx","sumdt","currTime","Date","now","announceInfo","fun","db","getData","length","range","forEach","value","key","nextShowTime","sortAnnounceInfo","onAnnounceInfoEvent","event","add","bind","initGongGao","color","string","update","dt","_isSuperSchedule","superDt","_superValue","_isNormalPlaying","_isNormalSchedule","_isSuperPlaying","currPlayIdx","normalDt","onDestroy","remove","sort","a","b","data","superValue","undefined"],"mappings":"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","file":"hallGangGao.js","sourceRoot":"../../../../../../assets/hall/script/hall","sourcesContent":["cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        mask: {\r\n            type: cc.Node,\r\n            default: null,\r\n        },\r\n\r\n        content: {\r\n            type: cc.Node,\r\n            default: null,\r\n        },\r\n\r\n        contentLabel: {\r\n            type: cc.Label,\r\n            default: null,\r\n        },\r\n\r\n        normalColor: {\r\n            default: cc.Color.WHITE,\r\n        },\r\n\r\n        superColor: {\r\n            default: cc.Color.WHITE,\r\n        },\r\n    },\r\n\r\n    onLoad () {\r\n        this.minx = this.mask.x - this.mask.width / 2 - 50;\r\n        this.startx = this.content.x;\r\n        this.sumdt = 0;\r\n        this.currTime = Date.now();\r\n\r\n        this.announceInfo = fun.db.getData('AnnounceInfo');\r\n        if (this.announceInfo.length === 0) {\r\n            this.announceInfo = [\r\n                {content: '搓搓麻将新版正式公测，所有游戏免费畅玩！', range: 10, type: 11},\r\n                {content: '文明游戏，严禁赌博！', range: 10, type: 11}\r\n            ];\r\n        }\r\n        this.announceInfo.forEach(function(value, key) {\r\n            if (value.type === 11) {\r\n                this.announceInfo[key].nextShowTime = this.currTime + value.range * 1000;\r\n            } else {\r\n                this.announceInfo[key].nextShowTime = this.currTime;\r\n            }\r\n\r\n        }, this);\r\n        this.sortAnnounceInfo();\r\n\r\n        this.onAnnounceInfoEvent(this.announceInfo);\r\n        fun.event.add('HallGangGao', 'AnnounceInfo', this.onAnnounceInfoEvent.bind(this));\r\n    }, \r\n\r\n    initGongGao (content, color) {\r\n        this.content.x = this.startx;\r\n        this.contentLabel.string = content;\r\n        this.content.color = color;\r\n    },\r\n\r\n    update (dt) {\r\n        this.sumdt += dt;\r\n        if (this.sumdt >= 1) {\r\n            this.currTime += 1000;\r\n            this.sumdt -= 1;\r\n        }\r\n        \r\n        if (this._isSuperSchedule) {\r\n            this.superDt = (this.superDt ? this.superDt : 0) + dt;\r\n            if (this.superDt >= this._superValue.range) {\r\n                this.superDt -= this._superValue.range;\r\n                this.initGongGao(this._superValue.content, this.superColor);\r\n                this._isSuperSchedule = false;\r\n                this._isNormalPlaying = false;\r\n                this._isNormalSchedule = false;\r\n                this._isSuperPlaying = true;\r\n            }\r\n        }\r\n        if (this._isSuperPlaying) {\r\n            this.content.x -= 2;\r\n            if (this.content.x + this.content.width <= this.minx) {\r\n                this._isNormalPlaying = true;\r\n                this.initGongGao(this.announceInfo[this.currPlayIdx].content, this.normalColor);\r\n                this._isSuperPlaying = false;\r\n                this._isSuperSchedule = true;\r\n            }\r\n        }\r\n\r\n        if (this._isNormalSchedule) {\r\n            this.normalDt = (this.normalDt ? this.normalDt : 0) + dt;\r\n            if (this.normalDt >= this.announceInfo[this.currPlayIdx].range) {\r\n                this.normalDt -= this.announceInfo[this.currPlayIdx].range;\r\n                this.initGongGao(this.announceInfo[this.currPlayIdx].content, this.normalColor);\r\n                this._isNormalSchedule = false;\r\n                this._isNormalPlaying = true;\r\n            }\r\n        }\r\n        if (this._isNormalPlaying) {\r\n            this.content.x -= 2;\r\n            if (this.content.x + this.content.width <= this.minx) {\r\n                this.currPlayIdx = this.currPlayIdx <  (this.announceInfo.length - 1) ? (this.currPlayIdx + 1) : 0;\r\n                this._isNormalSchedule = true;\r\n                this._isNormalPlaying = false;\r\n            }\r\n        }\r\n    },\r\n\r\n    onDestroy() {\r\n        fun.event.remove('HallGangGao');\r\n    },\r\n\r\n    sortAnnounceInfo() {\r\n        this.announceInfo.sort(function(a, b) {\r\n            return a.nextShowTime - b.nextShowTime;\r\n        });\r\n    },\r\n\r\n    onAnnounceInfoEvent(data) {\r\n        this._isNormalPlaying = false;\r\n        this._isNormalSchedule = false;\r\n        this._isSuperPlaying = false;\r\n        this._isSuperSchedule = false;\r\n        let superValue = undefined;\r\n        data.forEach(function(value, key) {\r\n            if (value.type === 11) {\r\n                data[key].nextShowTime = this.currTime + value.range * 1000;\r\n            } else {\r\n                superValue = value;\r\n            }\r\n        }, this);\r\n        this.announceInfo = data;\r\n        this.sortAnnounceInfo();\r\n        this.currPlayIdx = 0;\r\n        if (!superValue) {\r\n            this.initGongGao(this.announceInfo[this.currPlayIdx].content, this.normalColor);\r\n            this._isNormalPlaying = true;\r\n        } else {\r\n            this.currPlayIdx = 1;\r\n            this._superValue = superValue;\r\n            this.initGongGao(superValue.content, this.superColor);\r\n            this._isSuperPlaying = true;\r\n        }\r\n    },\r\n\r\n});\r\n"]}