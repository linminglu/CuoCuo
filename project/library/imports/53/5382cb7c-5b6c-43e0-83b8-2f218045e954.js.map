{"version":3,"sources":["../../../../../../assets/mahjong/script/ui/assets/mahjong/script/ui/mjMenuUI.js"],"names":["gameManager","require","mjNetMgr","mjDataMgr","BgPathName","open3D","cc","Class","extends","Component","properties","menuParentN","Node","menuP","Prefab","settingP","mjVotingUIP","gameBg","mjSkinP","onLoad","defautSkin","refreGameBg","fun","event","add","bind","onDestroy","voteNode","undefined","remove","start","curBgIndex","sys","localStorage","getItem","is3D","loader","loadRes","SpriteFrame","err","frame","getComponent","Sprite","spriteFrame","onBtnMenuOpened","playEffect","menuN","instantiate","setPosition","p","MenuNode","addChild","btnCloseN","getChildByName","btnExit","btnSkin","btnSetting","btn2D","btn3D","on","onBtnClose","onBtnExit","onBtnSkin","onBntSetting","onViewChange","refreViewBtn","curView","inFaPai","isChangeing","newView","setItem","dispatch","utils","setBtnEnabled","is3dView","active","setTimeout","removeFromParent","mjVotingUi","parent","director","getScene","roomInfo","get","KEYS","ROOMINFO","Round","getInstance","isRoomMaster","setTips","skinN","initSkin","settingN","hideWriteOffBtn","backN","btnClose","animation","Animation","play","getClips","name","once","refreshData","i","skinChild"],"mappings":"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","file":"mjMenuUI.js","sourceRoot":"../../../../../../assets/mahjong/script/ui","sourcesContent":["var gameManager = require(\"mjGameManager\");\nvar mjNetMgr    = require(\"mjNetMgr\");\nvar mjDataMgr   = require(\"mjDataMgr\");\nvar BgPathName  = \"mahjong/background/yxmj_zhuomian\"\nvar open3D      = false;\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        menuParentN: cc.Node,\n        menuP      : cc.Prefab,    \n        settingP   : cc.Prefab, \n        // voteP      : cc.Prefab,\n        mjVotingUIP: cc.Prefab,\n        gameBg     : cc.Node,\n        mjSkinP    : cc.Prefab,\n    },\n\n    onLoad () {\n        this.defautSkin = 1;\n        this.refreGameBg();\n        fun.event.add(\"mjViewMenu\", \"mjViewChange\", this.refreGameBg.bind(this));\n    },\n\n    onDestroy(){\n        this.voteNode = undefined;\n        fun.event.remove(\"mjViewMenu\");\n    },\n\n    start () {\n    },\n\n    refreGameBg(){\n        var curBgIndex = cc.sys.localStorage.getItem(\"MJBgIndex\") || this.defautSkin;\n        let is3D = cc.sys.localStorage.getItem(\"mjEyeView\") == \"3D\";\n        curBgIndex = is3D ? \"3d\" : curBgIndex;\n        cc.loader.loadRes(BgPathName+curBgIndex, cc.SpriteFrame,function(err, frame){\n            this.gameBg.getComponent(cc.Sprite).spriteFrame = frame;\n        }.bind(this));\n    },\n\n    onBtnMenuOpened (){\n        require(\"Audio\").playEffect(\"hall\", \"button_nomal.mp3\");\n        var menuN     = cc.instantiate(this.menuP);\n        menuN.setPosition(cc.p(471, 0))\n        this.MenuNode = menuN;\n        this.menuParentN.addChild(menuN);\n        var btnCloseN = this.MenuNode.getChildByName(\"btn_f\");\n        var btnExit   = this.MenuNode.getChildByName(\"btn_c\");\n        var btnSkin   = this.MenuNode.getChildByName(\"btn_b\");\n        var btnSetting= this.MenuNode.getChildByName(\"btn_a\");\n        this.btn2D    = this.MenuNode.getChildByName(\"btn_2d\");\n        this.btn3D    = this.MenuNode.getChildByName(\"btn_3d\");\n        btnCloseN.on(\"touchend\", this.onBtnClose, this);\n        btnExit.on(\"touchend\", this.onBtnExit, this);\n        btnSkin.on(\"touchend\", this.onBtnSkin, this);\n        this.btnSkin = btnSkin;\n        btnSetting.on(\"touchend\", this.onBntSetting, this);\n        this.btn2D.on(\"touchend\", function(){\n            this.onViewChange(\"2d\");\n        }, this)\n        this.btn3D.on(\"touchend\", function(){\n            this.onViewChange(\"3d\");\n        }, this)\n        this.refreViewBtn();\n        menuN.getChildByName(\"hitzone\").on(\"touchend\", this.onBtnClose, this);\n    },\n\n\n    onViewChange(curView){\n        if(require(\"mjGameManager\").inFaPai){return}\n        if(this.isChangeing){return}\n        this.isChangeing =  true;\n        let newView = curView == \"2d\" ? \"2D\" : \"3D\"\n        cc.sys.localStorage.setItem(\"mjEyeView\", newView);\n        fun.event.dispatch(\"mjViewChange\")\n        this.refreViewBtn();\n        fun.utils.setBtnEnabled(this.btn2D, false);\n        fun.utils.setBtnEnabled(this.btn3D, false);\n    },\n\n    refreViewBtn(){\n        var is3dView       = cc.sys.localStorage.getItem(\"mjEyeView\")==\"3D\" && open3D;\n        this.btn2D.active  = is3dView && open3D;\n        this.btn3D.active  = !is3dView && open3D;\n        fun.utils.setBtnEnabled(this.btnSkin, !is3dView);\n        // this.btnSkin.color = is3dView ? (new cc.Color(100, 100, 100)) : (new cc.Color(255, 255, 255));\n        //防止切换过快\n        setTimeout(function(){\n            this.isChangeing   =  false;\n            fun.utils.setBtnEnabled(this.btn2D, true);\n            fun.utils.setBtnEnabled(this.btn3D, true);\n        }.bind(this), 2000)\n        \n    },\n\n    //close menu\n    onBtnClose (event){\n        require(\"Audio\").playEffect(\"hall\", \"button_close.mp3\");\n        this.MenuNode.removeFromParent();\n    },\n\n    //exit room\n    onBtnExit(event){\n        require(\"Audio\").playEffect(\"hall\", \"button_nomal.mp3\");\n        let mjVotingUi = cc.instantiate(this.mjVotingUIP);\n        mjVotingUi.parent = cc.director.getScene().getChildByName('Canvas');\n        var roomInfo    = mjDataMgr.get(mjDataMgr.KEYS.ROOMINFO);\n        if(roomInfo.Round < 1 &&  mjDataMgr.getInstance().isRoomMaster()){\n             mjVotingUi.getComponent(\"mjVotingUI\").setTips(\"确定解散房间?\");\n        }\n       \n        this.onBtnClose();\n    },\n\n    //change room Skin\n    onBtnSkin(event){\n        if(cc.sys.localStorage.getItem(\"mjEyeView\") == \"3D\"){return}\n        require(\"Audio\").playEffect(\"hall\", \"button_nomal.mp3\");\n        this.skinN = cc.instantiate(this.mjSkinP);\n        this.menuParentN.addChild(this.skinN);\n        this.initSkin(this.skinN);\n    },\n\n    //open seting UI\n    onBntSetting(event){\n        require(\"Audio\").playEffect(\"hall\", \"button_nomal.mp3\");\n        this.settingN = cc.instantiate(this.settingP);\n        this.menuParentN.addChild(this.settingN);\n        this.settingN.getComponent(\"set\").hideWriteOffBtn();\n    },\n\n    initSkin(){\n        var curBgIndex = cc.sys.localStorage.getItem(\"MJBgIndex\") || this.defautSkin;\n        let backN    = this.skinN.getChildByName(\"back\")\n        let btnClose = backN.getChildByName(\"btnQuit\");\n        btnClose.on(\"touchend\", function(){\n            var animation = this.skinN.getComponent(cc.Animation)\n            animation.play(animation.getClips()[1].name).once('finished', function () {\n                this.skinN.removeFromParent();\n            }, this);\n        }, this);\n        backN.refreshData = function(){\n            for(let i=1; i<5; i++){\n                let skinChild = backN.getChildByName(\"skin\"+i);\n                skinChild.getChildByName(\"choose\").active = (curBgIndex == i);\n            }\n        }\n        for(let i=1; i<5; i++){\n              let skinChild = backN.getChildByName(\"skin\"+i);\n              skinChild.on(\"touchend\", function(){\n                    curBgIndex = i;\n                    cc.sys.localStorage.setItem(\"MJBgIndex\", i)\n                    this.refreGameBg();\n                    backN.refreshData();\n              }, this)\n        }\n        backN.refreshData();\n    },\n\n});\n"]}