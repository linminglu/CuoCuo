{"version":3,"sources":["../../../../../../assets/mahjong/script/ui/assets/mahjong/script/ui/mjReadyUI.js"],"names":["mjDataMgr","require","gameManager","GameDefine","log","cc","mjNetMgr","Class","extends","Component","properties","readyN","Node","typeConentN","reportN","reportTipsN","mjVotingUIP","Prefab","roomIdN","onLoad","fun","event","add","refreBtnReady","bind","getChildByName","getComponent","Label","string","get","KEYS","ROOMID","onDestroy","remove","initUI","roomInfo","isHy","db","getData","GameType","gameConst","gameType","maJiangHuangYan","iss","isReplayPai","active","isMaster","getInstance","isRoomMaster","gameCfg","releaseType","apple","isGamePlayed","Round","hideRoomOptBtn","onBtnWxShareRoomInfo","roomShowList","ROOMINFO","showList","content","forEach","itemData","index","name","info","title","gameName","WxShareFriend","onEveryOneReady","self","moveAct","moveTo","p","runAction","sequence","callFunc","onBtnDissolveClicked","mjVotingUi","instantiate","parent","director","getScene","setTips","onBtnExitClicked","onBtnReadyClicked","playEffect","prepareToPlay","onBtnUnReadyClicked","refreRoomData","centerN","roomInfoN","children","child","height","length","itemN","nameN","contentN","mdIdx","SELFID","mePlayerData","getPlayerData","isReady","Status","PLAYER_READY","READY","checkCanReady","isNoCard","NO_CARD","PlayerID","UID","cSend","rsp","RetCode","dissolvedRoom","roomID","exitOutRoom","Leave","exiteRoom","unPrepareToPlay","argument"],"mappings":"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","file":"mjReadyUI.js","sourceRoot":"../../../../../../assets/mahjong/script/ui","sourcesContent":["var mjDataMgr     = require(\"mjDataMgr\");\nvar gameManager     = require(\"mjGameManager\");\nvar GameDefine      = require(\"mjGameDefine\");\nvar log             = cc.log;\n// var FromPhone  = require(\"FromPhone\");\nvar mjNetMgr   = require(\"mjNetMgr\");\n\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        readyN     : cc.Node, \n        typeConentN: cc.Node,\n        reportN    : cc.Node,\n        reportTipsN: cc.Node,\n        mjVotingUIP: cc.Prefab,\n        roomIdN    : cc.Node,\n    },\n\n    onLoad : function(){\n        fun.event.add(\"selfReady\", \"selfReady\", this.refreBtnReady.bind(this))\n        this.roomIdN.getChildByName(\"content\").getComponent(cc.Label).string = mjDataMgr.get(mjDataMgr.KEYS.ROOMID);\n    },\n\n    onDestroy : function(){\n        fun.event.remove(\"selfReady\");\n    },\n\n    initUI : function(roomInfo){\n        var isHy= fun.db.getData('RoomInfo').GameType == gameConst.gameType.maJiangHuangYan\n        var iss = require(\"mjReplayMgr\").isReplayPai();\n        this.reportTipsN.active = isHy && !iss;\n        var isMaster                                     = mjDataMgr.getInstance().isRoomMaster();\n        this.readyN.getChildByName('btnUnReady').active  = false;\n        this.readyN.getChildByName(\"btnDissolve\").active = isMaster;\n        this.readyN.getChildByName(\"btnOut\").active      = !isMaster;\n        this.readyN.getChildByName('btnInvite').active   = !(fun.gameCfg.releaseType === gameConst.releaseType.apple); \n        //is the game aleady begin\n        var isGamePlayed        = (roomInfo.Round > 0)\n        this.roomIdN.active     = isGamePlayed;\n        if(isGamePlayed){\n            this.hideRoomOptBtn();\n            this.reportTipsN.active = false;\n        }\n    },\n\n\n    //wechat share room info\n    onBtnWxShareRoomInfo : function () {\n        var roomShowList = mjDataMgr.get(mjDataMgr.KEYS.ROOMINFO).showList;\n        var content      = \"\";\n        roomShowList.forEach(function(itemData, index){\n            content += \" \" +itemData.name +\":\" + itemData.content;\n        });\n        var info   = {content : content};\n        info.title = mjDataMgr.get(\"CfgData\").gameName + \"-房间号：\" + mjDataMgr.get(mjDataMgr.KEYS.ROOMID);\n        require(\"JSPhoneWeChat\").WxShareFriend(info);\n    },\n\n    onEveryOneReady : function(){\n        var self = this;\n        var moveAct = cc.moveTo(0.3, cc.p(0, -800));\n        this.readyN.runAction(cc.sequence(moveAct, cc.callFunc(function(){\n            self.readyN.active = false;\n            self.reportTipsN.active = false;\n        })))\n    },\n\n    onBtnDissolveClicked : function () {\n        let mjVotingUi = cc.instantiate(this.mjVotingUIP);\n        mjVotingUi.parent = cc.director.getScene().getChildByName('Canvas');\n        mjVotingUi.getComponent(\"mjVotingUI\").setTips(\"确定解散房间？\");\n    },\n\n    onBtnExitClicked : function () {\n        let mjVotingUi = cc.instantiate(this.mjVotingUIP);\n        mjVotingUi.parent = cc.director.getScene().getChildByName('Canvas');\n    },\n\n    //准备\n    onBtnReadyClicked : function(){\n         require(\"Audio\").playEffect(\"hall\", \"button_nomal.mp3\");\n        // // this.readyN.getChildByName('btnUnReady').active = true;\n        this.prepareToPlay();\n    }, \n\n    //取消准备\n    onBtnUnReadyClicked : function(){\n        require(\"Audio\").playEffect(\"hall\", \"button_nomal.mp3\");\n        // this.unPrepareToPlay();\n    }, \n\n    refreRoomData : function(){\n        var roomInfo = mjDataMgr.get(mjDataMgr.KEYS.ROOMINFO);\n        this.initUI(roomInfo);\n        //set room id\n        var centerN  = this.readyN.getChildByName(\"center\");\n        var roomIdN  = centerN.getChildByName(\"roomNumber\").getChildByName('content');\n        var roomInfoN= centerN.getChildByName(\"info\");\n        roomIdN.getComponent(cc.Label).string = mjDataMgr.get(mjDataMgr.KEYS.ROOMID);\n        //set room type list\n        var roomShowList = mjDataMgr.get(mjDataMgr.KEYS.ROOMINFO).showList;\n        this.typeConentN.children.forEach(function(child){\n            child.active = false;\n        })\n        this.typeConentN.height = roomShowList.length * 50;\n        roomShowList.forEach(function(itemData, index){\n            let itemN    = this.typeConentN.getChildByName(\"item_\"+index);\n            itemN.active = true\n            let nameN    = itemN.getChildByName(\"title\").getChildByName(\"name\");\n            let contentN = itemN.getChildByName(\"content\");\n            nameN.getComponent(cc.Label).string    = itemData.name;\n            contentN.getComponent(cc.Label).string = itemData.content;\n        }.bind(this))\n        this.refreBtnReady();\n    },\n\n    refreBtnReady : function(){\n        var mdIdx        = mjDataMgr.get(mjDataMgr.KEYS.SELFID);\n        var mePlayerData = mjDataMgr.getInstance().getPlayerData(mdIdx);\n        var isReady      = (mePlayerData.Status === GameDefine.PLAYER_READY.READY)\n        this.readyN.getChildByName('btnReady').active = !isReady; \n    },\n\n    hideRoomOptBtn : function(){\n        this.readyN.getChildByName(\"btnDissolve\").active = false;\n        this.readyN.getChildByName(\"btnOut\").active      = false;\n        this.readyN.getChildByName('btnInvite').active   = false; \n        // this.prepareToPlay();\n    },\n\n\n    checkCanReady : function(){\n        var mdIdx        = mjDataMgr.get(mjDataMgr.KEYS.SELFID);\n        var mePlayerData = mjDataMgr.getInstance().getPlayerData(mdIdx);\n        var isNoCard    = (mePlayerData.Status === GameDefine.PLAYER_READY.NO_CARD);\n        if(isNoCard){\n            // var text = \"您拥有的房卡数量少于房间所需数量\";\n            // NetMessageMgr.showTips(text);\n        }\n        return !isNoCard;\n    },\n\n    /*-----------------------------  Server Message -------------------------*/\n    prepareToPlay : function () {\n        if(!this.checkCanReady()){return}\n        var content = {};\n        content.PlayerID = mjDataMgr.get(mjDataMgr.KEYS.UID);\n        \n        mjNetMgr.cSend(\"gotoReady\", content, function(rsp){\n            if(rsp.RetCode == 0){\n                // this.readyN.getChildByName('btnReady').active = false; \n            }\n        }.bind(this));\n    },\n\n    dissolvedRoom : function () {\n        var content    = {roomID: mjDataMgr.get(mjDataMgr.KEYS.ROOMID)}\n        mjNetMgr.cSend(\"dissolvedRoom\", content);\n    },\n\n    exitOutRoom : function(){\n        var content    = {}\n        content.roomID = mjDataMgr.get(mjDataMgr.KEYS.ROOMID);\n        mjNetMgr.cSend(\"exitOutRoom\", content, function(rsp){\n            if(rsp.Leave){\n               gameManager.exiteRoom(); \n            }\n        });\n    },\n    //取消准备\n    unPrepareToPlay : function(argument) {\n\n    },\n\n    /*-----------------------------  End -----------------------------------*/\n\n});\n"]}