{"version":3,"sources":["../../../../../../assets/hall/script/fun/assets/hall/script/fun/funLog.js"],"names":["logger","cc","sys","isBrowser","logPath","path","join","jsb","fileUtils","getWritablePath","isDirectoryExist","createDirectory","saveTime","fun","gameCfg","logSaveDay","now","Date","files","listFiles","i","length","extname","time","parseInt","basename","removeFile","fileName","isFileExist","writeStringToFile","tag","gameConst","logTags","logLevel","values","console","log","valueStr","JSON","stringify","str","appendStringToFile","desc","logurl","logUrl","socket","WebSocket","binaryType","onopen","event","userInfo","db","getData","req","UserId","UserName","name","FileName","FileConcent","getStringFromFile","send","close","onclose","onerror","onmessage","module","exports"],"mappings":";;;;;;;;;;IAAMA;AACF,sBAAc;AAAA;;AACV,YAAIC,GAAGC,GAAH,CAAOC,SAAX,EAAsB;AAClB;AACH;AACD,YAAMC,UAAUH,GAAGI,IAAH,CAAQC,IAAR,CAAaC,IAAIC,SAAJ,CAAcC,eAAd,EAAb,EAA8C,WAA9C,CAAhB;AACA,YAAI,CAACF,IAAIC,SAAJ,CAAcE,gBAAd,CAA+BN,OAA/B,CAAL,EAA8C;AAC1CG,gBAAIC,SAAJ,CAAcG,eAAd,CAA8BP,OAA9B;AACH;AACD,YAAMQ,WAAWC,IAAIC,OAAJ,CAAYC,UAAZ,GAAyB,EAAzB,GAA8B,EAA9B,GAAmC,EAAnC,GAAwC,IAAzD;AACA,YAAMC,MAAMC,KAAKD,GAAL,EAAZ;AACA,YAAME,QAAQX,IAAIC,SAAJ,CAAcW,SAAd,CAAwBf,OAAxB,CAAd;AACA,aAAK,IAAIgB,IAAI,CAAb,EAAgBA,IAAIF,MAAMG,MAA1B,EAAkCD,GAAlC,EAAuC;AACnC,gBAAInB,GAAGI,IAAH,CAAQiB,OAAR,CAAgBJ,MAAME,CAAN,CAAhB,MAA8B,MAAlC,EAA0C;AACtC;AACH;AACD,gBAAMG,OAAOC,SAASvB,GAAGI,IAAH,CAAQoB,QAAR,CAAiBP,MAAME,CAAN,CAAjB,EAA2B,MAA3B,CAAT,EAA6C,EAA7C,CAAb;AACA,gBAAIJ,MAAMO,IAAN,IAAcX,QAAlB,EAA4B;AACxBL,oBAAIC,SAAJ,CAAckB,UAAd,CAAyBR,MAAME,CAAN,CAAzB;AACH;AACJ;AACD,aAAKO,QAAL,GAAgB1B,GAAGI,IAAH,CAAQC,IAAR,CAAaF,OAAb,EAAsBY,MAAM,MAA5B,CAAhB;AACA,YAAI,CAACT,IAAIC,SAAJ,CAAcoB,WAAd,CAA0B,KAAKD,QAA/B,CAAL,EAA+C;AAC3CpB,gBAAIC,SAAJ,CAAcqB,iBAAd,eAA4Cb,GAA5C,SAAqD,KAAKW,QAA1D;AACH;AACJ;;;;4BAEGG,KAAgB;AAChB,gBAAI,CAACC,UAAUC,OAAV,CAAkBF,GAAlB,CAAD,IAA2BC,UAAUC,OAAV,CAAkBF,GAAlB,IAAyBjB,IAAIC,OAAJ,CAAYmB,QAApE,EAA8E;AAC1E;AACH;;AAHe,8CAARC,MAAQ;AAARA,sBAAQ;AAAA;;AAIhB,gBAAIjC,GAAGC,GAAH,CAAOC,SAAX,EAAsB;AAClBgC,wBAAQC,GAAR,OAAgBN,GAAhB,QAAwBI,MAAxB;AACA;AACH;AACD,gBAAIG,WAAW,EAAf;AACA,gBAAIH,OAAOb,MAAP,KAAkB,CAAlB,IAAwB,OAAOa,OAAO,CAAP,CAAP,KAAqB,QAAjD,EAA4D;AACxDG,2BAAWH,OAAO,CAAP,CAAX;AACH,aAFD,MAEO;AACHG,2BAAWC,KAAKC,SAAL,CAAeL,MAAf,CAAX;AACH;AACD,gBAAIM,YAAUV,GAAV,UAAkBO,QAAlB,gBAAqCpB,KAAKD,GAAL,EAArC,OAAJ;AACAT,gBAAIC,SAAJ,CAAciC,kBAAd,CAAiCD,GAAjC,EAAsC,KAAKb,QAA3C;AACA1B,eAAGmC,GAAH,CAAOI,GAAP;AACH;;;kCAESE,MAAM;AACZ,gBAAMtC,UAAUH,GAAGI,IAAH,CAAQC,IAAR,CAAaC,IAAIC,SAAJ,CAAcC,eAAd,EAAb,EAA8C,WAA9C,CAAhB;AACA,gBAAMS,QAAQX,IAAIC,SAAJ,CAAcW,SAAd,CAAwBf,OAAxB,CAAd;AACA,gBAAMuC,SAAS9B,IAAIC,OAAJ,CAAY8B,MAA3B;AACA,gBAAIC,SAAS,IAAIC,SAAJ,CAAcH,MAAd,CAAb;AACAE,mBAAOE,UAAP,GAAoB,aAApB;AACAF,mBAAOG,MAAP,GAAgB,UAAUC,KAAV,EAAiB;AAC7B,oBAAIC,WAAWrC,IAAIsC,EAAJ,CAAOC,OAAP,CAAe,UAAf,CAAf;AACA,qBAAK,IAAIhC,IAAI,CAAb,EAAgBF,MAAMG,MAAtB,EAA8BD,GAA9B,EAAmC;AAC/B,wBAAInB,GAAGI,IAAH,CAAQiB,OAAR,CAAgBJ,MAAME,CAAN,CAAhB,MAA8B,MAAlC,EAA0C;AACtC;AACH;AACD,wBAAIiC,MAAM;AACNC,gCAAQJ,SAASI,MAAT,IAAmB,MADrB;AAENC,kCAAUL,SAASM,IAAT,IAAiB,SAFrB;AAGNC,kCAAUxD,GAAGI,IAAH,CAAQoB,QAAR,CAAiBP,MAAME,CAAN,CAAjB,EAA2B,MAA3B,CAHJ;AAINsC,qCAAanD,IAAIC,SAAJ,CAAcmD,iBAAd,CAAgCzC,MAAME,CAAN,CAAhC;AAJP,qBAAV;AAMAyB,2BAAOe,IAAP,CAAYtB,KAAKC,SAAL,CAAec,GAAf,CAAZ;AACH;AACDR,uBAAOgB,KAAP;AACH,aAfD;AAgBAhB,mBAAOiB,OAAP,GAAiB,UAAUb,KAAV,EAAiB;AAC9Bd,wBAAQC,GAAR,CAAY,SAAZ;AACH,aAFD;AAGAS,mBAAOkB,OAAP,GAAiB,UAAUd,KAAV,EAAiB;AAC9Bd,wBAAQC,GAAR,CAAY,SAAZ;AACH,aAFD;AAGAS,mBAAOmB,SAAP,GAAmB,UAAUf,KAAV,EAAiB;AAChCd,wBAAQC,GAAR,CAAY,WAAZ;AACH,aAFD;AAGH;;;;;;AAGL6B,OAAOC,OAAP,GAAiBlE,MAAjB","file":"funLog.js","sourceRoot":"../../../../../../assets/hall/script/fun","sourcesContent":["class logger {\r\n    constructor() {\r\n        if (cc.sys.isBrowser) {\r\n            return;\r\n        }\r\n        const logPath = cc.path.join(jsb.fileUtils.getWritablePath(), 'cuocuolog');\r\n        if (!jsb.fileUtils.isDirectoryExist(logPath)) {\r\n            jsb.fileUtils.createDirectory(logPath);\r\n        }\r\n        const saveTime = fun.gameCfg.logSaveDay * 24 * 60 * 60 * 1000;\r\n        const now = Date.now();\r\n        const files = jsb.fileUtils.listFiles(logPath);\r\n        for (let i = 0; i < files.length; i++) {\r\n            if (cc.path.extname(files[i]) !== '.log') {\r\n                continue;\r\n            }\r\n            const time = parseInt(cc.path.basename(files[i], '.log'), 10);\r\n            if (now - time >= saveTime) {\r\n                jsb.fileUtils.removeFile(files[i]);\r\n            }\r\n        }\r\n        this.fileName = cc.path.join(logPath, now + '.log');\r\n        if (!jsb.fileUtils.isFileExist(this.fileName)) {\r\n            jsb.fileUtils.writeStringToFile(`init log ${now}\\n`, this.fileName);\r\n        }\r\n    }\r\n\r\n    log(tag, ...values) {\r\n        if (!gameConst.logTags[tag] || gameConst.logTags[tag] > fun.gameCfg.logLevel) {\r\n            return;\r\n        }\r\n        if (cc.sys.isBrowser) {\r\n            console.log(`[${tag}]`, values);\r\n            return;\r\n        }\r\n        let valueStr = \"\";\r\n        if (values.length === 1 && (typeof values[0] === 'string')) {\r\n            valueStr = values[0];\r\n        } else {\r\n            valueStr = JSON.stringify(values)\r\n        }\r\n        let str = `[${tag}] ${valueStr} \\ttime:${Date.now()}\\n`;\r\n        jsb.fileUtils.appendStringToFile(str, this.fileName);\r\n        cc.log(str);\r\n    }\r\n\r\n    upLoadLog(desc) {\r\n        const logPath = cc.path.join(jsb.fileUtils.getWritablePath(), 'cuocuolog');\r\n        const files = jsb.fileUtils.listFiles(logPath);\r\n        const logurl = fun.gameCfg.logUrl;\r\n        let socket = new WebSocket(logurl);\r\n        socket.binaryType = 'arraybuffer';\r\n        socket.onopen = function (event) {\r\n            let userInfo = fun.db.getData('UserInfo');\r\n            for (let i = 0; files.length; i++) {\r\n                if (cc.path.extname(files[i]) !== '.log') {\r\n                    continue;\r\n                }\r\n                let req = {\r\n                    UserId: userInfo.UserId || 100000,\r\n                    UserName: userInfo.name || 'unknown',\r\n                    FileName: cc.path.basename(files[i], '.log'),\r\n                    FileConcent: jsb.fileUtils.getStringFromFile(files[i]),\r\n                };\r\n                socket.send(JSON.stringify(req));\r\n            }\r\n            socket.close();\r\n        };\r\n        socket.onclose = function (event) {\r\n            console.log(\"onclose\");\r\n        };\r\n        socket.onerror = function (event) {\r\n            console.log(\"onerror\");\r\n        };\r\n        socket.onmessage = function (event) {\r\n            console.log(\"onmessage\");\r\n        };\r\n    }\r\n}\r\n\r\nmodule.exports = logger;"]}