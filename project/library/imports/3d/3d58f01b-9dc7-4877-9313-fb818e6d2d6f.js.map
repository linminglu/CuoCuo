{"version":3,"sources":["../../../../../../../assets/mahjong/script/game/common/assets/mahjong/script/game/common/mjReplayMgr.js"],"names":["mjDataMgr","require","log","cc","GameDefine","pregameManager","gameReplayMgr","REPLAYOPT","MP","GMP","CP","CHI","PENG","MGT","PTH","MGO","AG","ZM","QGH","GCHZ","GMPZ","GQQH","hymjReplay","initData","data","meDeskIndex","replayData","record","startPai","zhuangIndex","i","push","length","RoomInfo","meIdx","GameType","gameConst","gameType","maJiangHuangYan","players","uif","RoomInformation","room_info","RoomId","room_id","fun","db","setData","resulteData","zhanji","registerOptFunclist","optList","opts","slice","reverse","director","loadScene","onDestroy","undefined","optFuncList","optTagList","defineList","mopaiOpt","chupaiOpt","chuPaiZuHeOpt","showResultOpt","guoPaiOpt","eatType","EATPAI_TYPE","Math","pow","ChiPai","PengPai","MingGang2","MingGang1","AnGang","creatOptData","opt","PlayerIdx","Atile","t","Opts","getOptTag","o","Data","d","lastChuPaiID","MoPaiNotice","gameManager","ChuPaiNotice","nextOpt","ChuPaiZuHeNotice","ShowResulted","ZhanJiNoticeHy","_ReplayUI","hdieReplay","setStartPai","directionList","DirectType","DIRECTION_TYPE","DONG","NAN","XI","BEI","meDirection","tempIndex","initReplayPai","CaiShenPai","cs","initRound","initRoundData","gameUICB","setCaiShenPai","faPaiNoAnim","showReduceNode","setBtnBackVisi","tag","stop","pop","optFunc","call","wlmjReplay","JSON","parse","base64","decode","shift","zhuangNotify","paiData","moPaiData","Players","UserId","Cards","Card","Idx","getplayerByUserID","caiShengPai","fapaiMo","Cmd","stringify","net","_onMessage","endReplay","_IsReplay","cleanPlayerPaiData","exiteRoom","startPlay","_CurIns","showReplay","refreDelayTime","_RealDelayTime","_OptDelayTime","_Speed","setSpeedScale","speed","_Replaying","resume","_RddDt","update","dt","isReplayPai","initTypeCfg","_TypeCfg","maJiangWenLing","init","replayUI","setReplayData","module","exports"],"mappings":"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","file":"mjReplayMgr.js","sourceRoot":"../../../../../../../assets/mahjong/script/game/common","sourcesContent":["var mjDataMgr = require(\"mjDataMgr\");\nvar log             = cc.log;\nvar GameDefine      = require(\"mjGameDefine\")\nvar pregameManager  = require(\"mjGameManager\");\n\n//战斗回放\nvar gameReplayMgr = {}\n//hy麻将 opt list\nconst REPLAYOPT = {\n\tMP:1,/*摸牌*/ GMP:2,/*杠后摸牌*/ CP:3,/*出牌*/ CHI:4, /*吃牌*/ PENG:5,/*碰牌*/ MGT:6,/*明杠2*/ PTH:7,/*普通胡*/\n\tMGO:8,/*明杠1*/ AG:9,/*暗杠2 */ ZM:10,/*自摸*/QGH:11,/*抢杠胡*/ GCHZ:12,/*过出牌组合*/ GMPZ:13,/*过摸排组合*/ GQQH:14,/*过抢杠胡*/\n}\n\n//黄岩是重新生成新的消息\nvar hymjReplay = function(){\n\tthis.initData = function(data){\n\t\tthis.meDeskIndex = 0;\n\t\tthis.replayData = data.record;\n\t\tthis.startPai   = [];\n\t\tthis.zhuangIndex = 0;\n\t\tfor(let i=0; i<4; i++){\n\t\t\tthis.startPai.push(data.record[\"p\"+i]);\n\t\t\tif(data.record[\"p\"+i].length == 14){\n\t\t\t\tthis.zhuangIndex = i;\n\t\t\t}\n\t\t}\n\t\tvar RoomInfo = {meIdx : this.meDeskIndex,  GameType:gameConst.gameType.maJiangHuangYan, \n\t\t\tplayers:data.record.uif, RoomInformation : data.record.room_info, RoomId : data.record.room_id};\n\t\tfun.db.setData('RoomInfo', RoomInfo);\n\t\tthis.resulteData = data.record.zhanji;\n\t    this.registerOptFunclist();\n\t \tthis.optList = data.record.opts.slice();\n\t\tthis.optList.reverse();\t\n\t\tcc.director.loadScene('majiang');\n\t}\n\n\tthis.onDestroy = function(){\n\t\tthis.replayData  = undefined;\n\t\tthis.resulteData = undefined;\n\t\tthis.meDeskIndex = undefined;\n\t\tthis.optFuncList = undefined;\n\t\tthis.optTagList  = undefined;\n\t\tthis.optList     = [];\n\t}\n\tthis.registerOptFunclist = function(){\n\t\tvar defineList               = REPLAYOPT;\n\t\tvar optFuncList              = {};\n\t\toptFuncList[defineList.MP]   = this.mopaiOpt;\n\t\toptFuncList[defineList.GMP]  = this.mopaiOpt;\n\t\toptFuncList[defineList.CP]   = this.chupaiOpt;\n\t\toptFuncList[defineList.CHI]  = this.chuPaiZuHeOpt;\n\t\toptFuncList[defineList.PENG] = this.chuPaiZuHeOpt;\n\t\toptFuncList[defineList.MGT]  = this.chuPaiZuHeOpt;\n\t\toptFuncList[defineList.PTH]  = this.showResultOpt;\n\t\toptFuncList[defineList.MGO]  = this.chuPaiZuHeOpt;\n\t\toptFuncList[defineList.AG]   = this.chuPaiZuHeOpt;\n\t\toptFuncList[defineList.ZM]   = this.showResultOpt;\n\t\toptFuncList[defineList.QGH]  = this.showResultOpt;\n\t\toptFuncList[defineList.GCHZ] = this.guoPaiOpt;\n\t\toptFuncList[defineList.GMPZ] = this.guoPaiOpt;\n\t\toptFuncList[defineList.GQQH] = this.guoPaiOpt;\n\t\tthis.optFuncList             = optFuncList;\n\t\tvar optTagList               = {};\n\t\tvar eatType                  = GameDefine.EATPAI_TYPE;\n\t\toptTagList[defineList.CHI]   = Math.pow(2,eatType.ChiPai);\n\t\toptTagList[defineList.PENG]  = Math.pow(2,eatType.PengPai);\n\t\toptTagList[defineList.MGT]   = Math.pow(2,eatType.MingGang2);\n\t\toptTagList[defineList.MGO]   = Math.pow(2,eatType.MingGang1);\n\t\toptTagList[defineList.AG]    = Math.pow(2,eatType.AnGang);\n\t\tthis.optTagList              = optTagList;\n\t}\n\tthis.creatOptData = function(opt){\n\t\tvar data       = {}\n\t\tdata.PlayerIdx = opt.i;\n\t\tdata.Atile     = opt.t;\n\t\tdata.Opts      = this.getOptTag(opt.o);\n\t\tdata.Data      = opt.d;\n\t\tif(data.Data){\n\t\t\tdata.Data.push(require(\"mjGameManager\").lastChuPaiID);\n\t\t}\n\t\treturn data;\n\t}\n\tthis.mopaiOpt = function(opt){\n\t\trequire(\"mjGameManager\").MoPaiNotice(this.creatOptData(opt));\n\t}\n\n\n\tthis.chupaiOpt = function(opt){\n\t\tvar gameManager         = require(\"mjGameManager\");\n\t\tgameManager.ChuPaiNotice(this.creatOptData(opt));\n\t}\n\n\tthis.guoPaiOpt = function(opt){\n\t\tthis.nextOpt();\n\t}\n\n\tthis.chuPaiZuHeOpt = function(opt){\n\t\tvar gameManager         = require(\"mjGameManager\");\n\t\tgameManager.ChuPaiZuHeNotice(this.creatOptData(opt))\n\t}\n\n\tthis.showResultOpt = function(){\n\t\tif(this.ShowResulted){return}\n\t\tthis.ShowResulted = true;\n\t\tvar gameManager         = require(\"mjGameManager\");\n\t\t/*  结算战绩  */\n\t\tgameManager.ZhanJiNoticeHy(this.resulteData);\n\t\tgameReplayMgr._ReplayUI.hdieReplay();\n\t}\n\n\tthis.setStartPai = function(){\n\t\tvar directionList = [];\n\t\tvar DirectType = GameDefine.DIRECTION_TYPE;\n\t\tdirectionList.push(DirectType.DONG);\n\t\tdirectionList.push(DirectType.NAN);\n\t\tdirectionList.push(DirectType.XI);\n\t\tdirectionList.push(DirectType.BEI);\n\t\tvar meDirection;\n\t\tfor(let i=0; i<4;i++){\n\t\t\tlet tempIndex = (i + this.zhuangIndex)%4;\n\t\t\tif(tempIndex == this.meDeskIndex){\n\t\t\t\tmeDirection = directionList[i];\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tvar gameManager         = require(\"mjGameManager\");\n\t\tgameManager.initReplayPai(this.startPai);\n\t\tgameManager.CaiShenPai  = [this.replayData.cs];\n\t\tgameManager.meDirection = meDirection;\n\n\t}\n\n\tthis.initRound = function(){\n\t\tthis.setStartPai();\n\t\tvar gameManager     = require(\"mjGameManager\");\n\t\tgameManager.initRoundData();\n\t\tgameManager.gameUICB.setCaiShenPai(gameManager.CaiShenPai);\n\t\tgameManager.faPaiNoAnim(false);\n\t\tgameManager.gameUICB.showReduceNode();\n\t\tgameManager.setBtnBackVisi(false);\n\t\tthis.ShowResulted = false;\n\n\t}\n\n\tthis.getOptTag = function(tag){\n\t\treturn this.optTagList[tag];\n\t}\n\n\tthis.nextOpt = function(){\n\t\tif(this.optList.length < 1){\n\t\t\tthis.showResultOpt();\n\t\t\tgameReplayMgr.stop();\n\t\t\treturn\n\t\t}\n\t\tvar opt = this.optList.pop();\n\t\tlog(\"cur Opt\", opt);\n\t\tvar optFunc = this.optFuncList[opt.o];\n\t\toptFunc.call(this, opt);\n\t}\n\n}\n\n//温岭麻将是将消息分装起来，这里重放就是伪装发消息\nvar wlmjReplay = function(){\n\tthis.initData = function(data){\n\t\tfor (let i = 0; i < data.record.length; i++) {\n            data.record[i].Data = JSON.parse(fun.base64.decode(data.record[i].Data));\n        }\n        this.optList = data.record;\n        let RoomInfo = this.optList.shift()\n        cc.log(\"RoomInfo     --<\",RoomInfo);\n        fun.db.setData('RoomInfo', RoomInfo.Data);\n        cc.director.loadScene('majiang');\n\t}\n\n\tthis.initRound = function(){\n\t\t// this.setStartPai();\n\t\tvar gameManager = require('mjGameManager');\n\t\tgameManager.zhuangNotify(this.optList.shift().Data)\n\t\tlet startPai    = [];\n\t\tlet paiData     = this.optList.shift().Data;\n\t\tlet moPaiData   = this.optList.shift().Data;\n\t\tpaiData.Players[moPaiData.UserId].Cards.push(moPaiData.Card);\n\t\tfor(let UserId in paiData.Players){\n\t\t\tlet Idx = gameManager.getplayerByUserID(UserId).PlayerIdx;\n\t\t\tstartPai[Idx] = paiData.Players[UserId].Cards;\n\t\t}\n\t\tgameManager.initReplayPai(startPai);\n\t\tgameManager.initRoundData();\n\t\tgameManager.caiShengPai(this.optList.shift().Data.Card);\n\t\tgameManager.gameUICB.setCaiShenPai(gameManager.CaiShenPai);\n\t\tgameManager.gameUICB.showReduceNode();\n\t\tgameManager.faPaiNoAnim(false);\n\t\tgameManager.fapaiMo = true\n\t\t// gameManager. \n\t}\n\n\tthis.nextOpt = function(){\n\t\tif(this.optList.length < 1){\n\t\t\treturn\n\t\t}\n\t\tvar opt  = this.optList.shift();\n\t\topt.data = opt.Cmd + JSON.stringify(opt.Data);\n\t\tfun.net._onMessage(opt);\n\t}\n}\n\n\n\n\n\n\ngameReplayMgr.endReplay = function(){\n\tthis._IsReplay = false;\n\t//var Audio           = require(\"Audio\");\n\t//Audio.playSystemSound(\"button_nomal.mp3\", false)\n\tvar gameManager     = require(\"mjGameManager\");\n    gameManager.cleanPlayerPaiData();\n   \tgameManager.exiteRoom();\n}\n\n\ngameReplayMgr.startPlay = function(){\t\n\tthis._CurIns.initRound();\n\tthis._ReplayUI.showReplay();\n\t\n}\n\n\ngameReplayMgr.refreDelayTime = function(){\n\tthis._RealDelayTime = this._OptDelayTime / this._Speed;\n}\n\ngameReplayMgr.setSpeedScale = function(speed){\n\tthis._Speed = speed;\n\tthis.refreDelayTime();\n\t\n}\n\n\ngameReplayMgr.nextOpt = function(){\n\tthis._CurIns.nextOpt();\n}\n\n\ngameReplayMgr.stop = function(){\n\tthis._Replaying = false;\n}\n\ngameReplayMgr.resume = function(){\n\tthis._Replaying = true;\n\tthis._RddDt= 0;\n\tthis.refreDelayTime();\n\tthis.nextOpt();\n}\n\ngameReplayMgr.update = function(dt){\n\tif(!this._Replaying || !this.isReplayPai()) {\n\t\treturn\n\t}\n\tthis._RddDt += dt;\n\tif(this._RddDt >= this._RealDelayTime){\n\t\tthis._RddDt -= this._RealDelayTime;\n\t\tthis.nextOpt();\n\t}\n}\n\ngameReplayMgr.onDestroy = function(){\n\tthis._IsReplay  = false;\n\tthis._Replaying = false;\n\tthis._Speed     = undefined;\n}\n\ngameReplayMgr.isReplayPai = function(){\n\treturn this._IsReplay;\n}\n\n\ngameReplayMgr.initTypeCfg = function() {\n\tthis._TypeCfg = {};\n\tthis._TypeCfg[gameConst.gameType.maJiangWenLing]  = wlmjReplay;\n\tthis._TypeCfg[gameConst.gameType.maJiangHuangYan] = hymjReplay;\n}\n\ngameReplayMgr.init = function(replayUI){\n\tthis._ReplayUI      = replayUI;\n\tthis._RddDt         = 0;\n\tthis._Speed         = 1;\n\tthis._RealDelayTime = this._OptDelayTime = 2;\n}\n\n\n\ngameReplayMgr.setReplayData = function(gameType, data){\n\tthis.initTypeCfg();\n\tthis._CurIns = new (this._TypeCfg[gameType])();\n\tthis._CurIns.initData(data)\n\tthis._IsReplay      = true;\n\tthis._Replaying     = false;\n}\n\n\n\n\n\n\n\n\n\n\n\n\nmodule.exports    = gameReplayMgr;\n"]}