{"version":3,"sources":["../../../../../../assets/poker/script/pukeComm/assets/poker/script/pukeComm/CuoPai.js"],"names":["PukeDefine","require","PukeUtils","cc","Class","extends","Component","properties","Background","Node","PukeNode","Puke","sp","Skeleton","CuoPaiTime","ScaleTime","liangPaiScaleTime","startTouchFunc","event","beganTime","Date","parse","sys","isNative","beganPos","getStartLocation","lastPos","p","x","y","moveTouchFunc","setDisy","touch","getDelta","movePos","getLocation","disy","endCancelTouchFunc","endTime","fanPai","pos","cancelFanPai","touchOn","on","touchOff","off","update","dt","isFan","state","setAnimation","timeScale","playing","onDestroy","tmpDisy","initPuke","data","pukeNumber","Math","abs","num","modelIndex","callback","cb","GameType","_rotateDelay","from","initAnimation","type","self","modelName","PUKE","spName","url","RESOURCE_FOLDER_PATH","SPINE","FAN_PAI","LoadRes","res","skeletonData","rotation","setCompleteListener","trackEntry","animation","name","addAnimation","changCardModel","rotateBy","runAction","sequence","callFunc","onBtnCloseClicked"],"mappings":"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","file":"CuoPai.js","sourceRoot":"../../../../../../assets/poker/script/pukeComm","sourcesContent":["let PukeDefine = require(\"PukeDefine\");\r\nlet PukeUtils  = require(\"PukeUtils\");\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        Background        : cc.Node,\r\n        PukeNode          : cc.Node,\r\n        Puke              : sp.Skeleton,\r\n        CuoPaiTime        : 1000,        // 搓牌时间 单位:毫秒\r\n        ScaleTime         : 1.2,         // 搓牌翻牌动画时间\r\n        liangPaiScaleTime : 4,\r\n    },\r\n\r\n    startTouchFunc : function (event) {\r\n        this.beganTime = Date.parse(new Date());\r\n        if (!cc.sys.isNative) {\r\n            this.beganPos  = event.getStartLocation();\r\n            this.lastPos   = cc.p(this.beganPos.x, this.beganPos.y);\r\n        }\r\n    },\r\n    moveTouchFunc : function (event) {\r\n        if (cc.sys.isNative) {\r\n            this.setDisy(event.touch.getDelta().y);\r\n        } else {\r\n            let movePos   = event.getLocation();\r\n            let disy      = movePos.y - this.lastPos.y;\r\n            this.setDisy(disy);\r\n            this.lastPos  = cc.p(movePos.x, movePos.y);\r\n        }\r\n    },\r\n    endCancelTouchFunc : function (event) {\r\n        this.endTime = Date.parse(new Date());\r\n        if (this.endTime - this.beganTime < this.CuoPaiTime) {\r\n            if (cc.sys.isNative) {\r\n                let disy = event.touch.getDelta().y;\r\n                if (disy > 80) {\r\n                    this.fanPai();\r\n                    return;\r\n                }\r\n            } else {\r\n                let pos  = event.getLocation();\r\n                let disy = pos.y - this.beganPos.y;\r\n                if (disy > 80) {\r\n                    this.fanPai();\r\n                    return;\r\n                }\r\n            }\r\n        }\r\n        this.cancelFanPai();\r\n    },\r\n    touchOn : function () {\r\n        this.Background.on('touchstart',  this.startTouchFunc,     this);\r\n        this.Background.on('touchmove',   this.moveTouchFunc,      this);\r\n        this.Background.on('touchend',    this.endCancelTouchFunc, this);\r\n        this.Background.on('touchcancel', this.endCancelTouchFunc, this);\r\n    },\r\n    touchOff : function () {\r\n        this.Background.off('touchstart',  this.startTouchFunc,     this);\r\n        this.Background.off('touchmove',   this.moveTouchFunc,      this)\r\n        this.Background.off('touchend',    this.endCancelTouchFunc, this);\r\n        this.Background.off('touchcancel', this.endCancelTouchFunc, this);\r\n    },\r\n\r\n    update : function (dt) {\r\n        if (this.isFan) { return; }\r\n        if (this.disy > 0) {\r\n            if (this.state === \"Bei\") {\r\n                this.Puke.setAnimation(0, \"Fan\", false);\r\n                this.Puke.timeScale = this.ScaleTime;\r\n                this.state = \"Fan\";\r\n            } else if (this.state === \"Fan\") {\r\n                if (this.playing) {\r\n                    this.Puke.timeScale = this.ScaleTime;\r\n                } else {\r\n                    this.Puke.setAnimation(0, \"Zheng\", false);\r\n                    this.state = \"Zheng\";\r\n                }\r\n            }\r\n            this.disy = 0;\r\n        } else if (this.disy < 0) {\r\n            this.Puke.setAnimation(0, \"Bei\", false);\r\n            this.Puke.timeScale = this.ScaleTime;\r\n            this.state   = \"Bei\";\r\n            this.playing = true;\r\n            this.disy    = 0;\r\n        } else if (this.disy === 0) {\r\n            this.Puke.timeScale = 0;\r\n        }\r\n    },\r\n\r\n    onDestroy : function () {\r\n        this.touchOff();\r\n    },\r\n\r\n    setDisy : function (disy) {\r\n        if (disy < 0) {\r\n            this.tmpDisy = this.tmpDisy + disy;\r\n            if (this.tmpDisy < -5) {\r\n                this.disy = this.tmpDisy;\r\n                this.tmpDisy = 0;\r\n            }\r\n        } else {\r\n            this.disy = disy;\r\n            this.tmpDisy = 0;\r\n        }\r\n    },\r\n\r\n    initPuke : function (data) {\r\n        this.pukeNumber = Math.abs(data.num) - 3 || 4;\r\n        this.modelIndex = 0;\r\n        this.callback   = data.cb;\r\n        this.GameType   = data.GameType;\r\n        this.state = \"Bei\";\r\n        this.isFan = false;\r\n        this._rotateDelay = false;\r\n        this.touchOn();\r\n        if (data.from === \"liangPai\" || data.from === \"showCard\") {\r\n            this.initAnimation(\"liangPai\");\r\n        } else {\r\n            this.initAnimation();\r\n        }\r\n    },\r\n\r\n    initAnimation : function (type) {\r\n        let self = this;\r\n        this.playing = true;\r\n        this.state   = \"Bei\";\r\n        this.disy    = 0;\r\n        this.tmpDisy = 0;\r\n        let modelName = PukeDefine.PUKE['MODULE_NAME_'+this.GameType][this.modelIndex];\r\n        let spName   = modelName + \"/\" + modelName + \"_\" + this.pukeNumber;\r\n        let url      = PukeDefine.RESOURCE_FOLDER_PATH.SPINE.FAN_PAI + spName;\r\n        self.Puke.setAnimation(0, \"Bei\", false);\r\n        PukeUtils.LoadRes(url, \"sp.SkeletonData\", function(res){\r\n            self.Puke.skeletonData = res;\r\n            self.Puke.setAnimation(0, \"Bei\", false);\r\n            self.PukeNode.rotation = 0;\r\n            if(type && type === \"liangPai\"){\r\n                self.fanPai();\r\n                self.touchOff();\r\n            } else {\r\n                self.touchOn();\r\n            }\r\n        });\r\n        this.Puke.setCompleteListener(trackEntry => {\r\n            if (trackEntry.animation.name === \"Shang\" || \r\n                trackEntry.animation.name === \"Xia\"   || \r\n                trackEntry.animation.name === \"Fan\"   ||\r\n                trackEntry.animation.name === \"Zheng\" ){\r\n                self.callback();\r\n            }\r\n        });\r\n    },\r\n\r\n    fanPai : function () {\r\n        this.isFan = true;\r\n        if (this.state === \"Bei\") {\r\n            this.Puke.setAnimation(0, \"Fan\", false);\r\n            this.Puke.addAnimation(0, \"Zheng\", false);\r\n        } else if (this.state === \"Fan\") {\r\n            this.Puke.addAnimation(0, \"Zheng\", false);\r\n        }\r\n        this.Puke.timeScale = this.ScaleTime * 2;\r\n    },\r\n\r\n    cancelFanPai : function () {\r\n        if (this.state === \"Zheng\") {\r\n            return;\r\n        }\r\n        if (this.state === \"Fan\") {\r\n            this.fanPai();\r\n            return;\r\n        }\r\n        if (!this._rotateDelay) {\r\n            this._rotateDelay = true;\r\n            this.changCardModel();\r\n        }\r\n        \r\n    },\r\n\r\n    changCardModel : function () {\r\n        let self = this;\r\n        this.Puke.setAnimation(0, \"Bei\", false);\r\n        this.Puke.timeScale = this.ScaleTime;\r\n        this.state   = \"Bei\";\r\n        this.isFan   = false;\r\n        this.playing = true;\r\n        this.disy    = 0;\r\n        this.tmpDisy = 0;\r\n        let rotation = cc.rotateBy(0.5, 90);\r\n        this.PukeNode.runAction(cc.sequence(rotation, cc.callFunc(function(){\r\n            self.modelIndex += 1;\r\n            if (self.modelIndex >= 4) {\r\n                self.modelIndex = 0;\r\n            }\r\n            self.initAnimation();\r\n            self._rotateDelay = false;\r\n        })));\r\n    },\r\n\r\n    onBtnCloseClicked : function () {\r\n        this.fanPai();\r\n    }\r\n});"]}