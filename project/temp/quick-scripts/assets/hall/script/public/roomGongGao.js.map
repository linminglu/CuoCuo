{"version":3,"sources":["roomGongGao.js"],"names":["cc","Class","extends","Component","properties","mask","type","Node","default","content","contentLabel","Label","onLoad","init","minx","x","width","startx","isPlaying","sumdt","inited","currTime","Date","now","orignalPy","node","y","announceInfo","data","fun","db","getData","forEach","value","nextShowTime","push","event","add","onAnnounceInfoEvent","bind","length","update","dt","i","id","currid","range","find","string","onDestroy","remove","tmp","v","k"],"mappings":"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","file":"roomGongGao.js","sourceRoot":"../../../../../../assets/hall/script/public","sourcesContent":["cc.Class({\n    extends: cc.Component,\n\n    properties: {\n        mask: {\n            type: cc.Node,\n            default: null,\n        },\n\n        content: {\n            type: cc.Node,\n            default: null,\n        },\n\n        contentLabel: {\n            type: cc.Label,\n            default: null,\n        },\n    },\n\n    onLoad () {\n        this.init();\n    },\n\n\n    init(){\n        this.minx = this.mask.x - this.mask.width / 2 - 50;\n        this.startx = this.content.x;\n        this.isPlaying = false;\n        this.sumdt = 0;\n        this.inited = true\n        this.currTime = Date.now();\n        this.orignalPy = this.node.y;\n\n        this.announceInfo = [];\n        let data = fun.db.getData('AnnounceInfo') || [];\n        data.forEach(function(value) {\n            if (value.type !== 11) {\n                value.nextShowTime = this.currTime;\n                this.announceInfo.push(value);\n            }\n        }, this);\n        fun.event.add('RoomGongGaoAnnounceInfo', 'AnnounceInfo', this.onAnnounceInfoEvent.bind(this));\n        if (this.announceInfo.length === 0) {\n            this.node.y = this.orignalPy * 1000;\n        }\n    },\n\n\n    update(dt) {\n        if(!this.inited){\n            this.init();\n        }\n        this.sumdt += dt;\n        if (this.sumdt >= 1) {\n            this.currTime += 1000;\n            this.sumdt -= 1;\n        }\n\n        if (this.isPlaying) {\n            this.content.x -= 2;\n            if (this.content.x + this.content.width <= this.minx) {\n                for (let i = 0; i < this.announceInfo.length; i++) {\n                    if (this.announceInfo[i].id === this.currid) {\n                        this.announceInfo[i].nextShowTime = this.announceInfo[i].range * 1000 + this.currTime;\n                        break;\n                    } \n                }\n                this.isPlaying = false;\n            }\n        } else {\n            let find = false;\n            for (let i = 0; i < this.announceInfo.length; i++) {\n                if (this.announceInfo[i].nextShowTime <= this.currTime) {\n                    find = true;\n                    this.isPlaying = true;\n                    this.currid = this.announceInfo[i].id;\n                    this.content.x = this.startx;\n                    this.contentLabel.string = this.announceInfo[i].content;\n                    break;\n                }\n            }\n            if (find) {\n                this.node.y = this.orignalPy;\n            } else {\n                this.node.y = this.orignalPy * 1000;\n            }\n        }\n    },\n\n    onDestroy() {\n        fun.event.remove('RoomGongGaoAnnounceInfo')\n    },\n\n    onAnnounceInfoEvent(data) {\n        let tmp = [];\n        data.forEach(function(value) {\n            if (value.type !== 11) {\n                value.nextShowTime = this.currTime;\n                tmp.push(value);\n            }\n        }, this);\n        this.announceInfo.forEach(function(value) {\n            tmp.forEach(function(v, k) {\n                if (v.id === value.id) {\n                    tmp[k].nextShowTime = value.nextShowTime;\n                }\n            });\n        });\n        this.announceInfo = tmp;\n        if (this.announceInfo.length === 0) {\n            this.node.y = this.orignalPy * 1000;\n        } else {\n            this.node.y = this.orignalPy;\n        }\n    }\n});\n"]}