{"version":3,"sources":["gameMgrWahua.js"],"names":["JiaWeiEnum","cc","Enum","tianjia","dijia","yinpai","changsan","JiaWeiArr","WhUtils","require","Class","extends","Component","properties","btnExit","type","Node","default","btnReady","btnInvite","paiMianAltas","SpriteAtlas","onLoad","fun","event","dispatch","flag","net","setGameMsgCfg","_userId","db","getData","UserId","roomInfo","_gameStatu","roomRule","gameStatu","_isRoomOwner","toString","roomOwner","_playerNum","playerNum","_seat","Array","_seatDir","on","onBtnExitClick","onBtnReadyClick","onBtnInviteClick","registerListener","start","reconnet","pListen","onEnterRoomIn","bind","onOffLineIn","onOnLineIn","listen","onDisbandRoomIn","onReadyIn","onReadyNextIn","onDisbandRoomVoteIn","onDisbandRoomResultIn","onBankerIn","onRockCardIn","onUserRefreshIn","onNoneOpsIn","onStartGameIn","onPlayCardIn","onDrawCardIn","onOpsAcceptIn","onRepairCardIn","onOneAccountIn","onQuitRoomIn","onAllAccountIn","add","updateSeats","removeListener","rmPListen","rmListen","remove","onDestroy","p","ui","node","getChildByName","getComponent","pos","id","data","userId","undefined","log","getSeatByUserId","i","length","userMap","selfReadyState","currentState","setReadyState","nowZhuangjia","setJiaWeiShow","active","tSeat","tPos","newSeat","curPos","dir","cha","setDirect","send","rsp","exitRoom","applyStatu","returnStatu","seat","ready","showReady","key","userOneMap","setData","Zhuangjia","yzNode","rollChessDice","yz","getCardById","yzCard","Sprite","spriteFrame","getSpriteFrame","szCallback","szCard","szPoint","getSaiziPointByCard","point","callback","parseInt","outLine","userInfo","RoomId","director","loadScene"],"mappings":"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","file":"gameMgrWahua.js","sourceRoot":"../../../../../../../assets/mahjong/script/wahua/desk","sourcesContent":["const JiaWeiEnum = cc.Enum({\n    tianjia: 0,\n    dijia: 1,\n    yinpai: 2,\n    changsan: 3,\n});\nconst JiaWeiArr = ['tianjia', 'dijia', 'yinpai', 'changsan'];\nconst WhUtils = require('whUtils');\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        btnExit: {\n            type: cc.Node,\n            default: null,\n        },\n\n        btnReady: {\n            type: cc.Node,\n            default: null,\n        },\n\n        btnInvite: {\n            type: cc.Node,\n            default: null,\n        },\n\n        paiMianAltas: {\n            type: cc.SpriteAtlas,\n            default: null,\n        },\n    },\n\n    onLoad () {\n        fun.event.dispatch('Zhuanquan', {flag: false});\n        fun.net.setGameMsgCfg(require('WahuaCfg'));\n        this._userId = fun.db.getData('UserInfo').UserId;\n        let roomInfo = fun.db.getData('RoomInfo');\n        this._gameStatu = roomInfo.roomRule.gameStatu;\n        this._isRoomOwner = (this._userId.toString() === roomInfo.roomRule.roomOwner);\n        this._playerNum = roomInfo.roomRule.playerNum;\n        this._seat = new Array();\n        this._seatDir = ['xia', 'you', 'shang', 'zuo'];\n\n        this.btnExit.on('click', this.onBtnExitClick, this);\n        this.btnReady.on('click', this.onBtnReadyClick, this);\n        this.btnInvite.on('click', this.onBtnInviteClick, this);\n        this.registerListener();\n    },\n\n    start() {\n        this.reconnet();\n    },\n\n    registerListener() {\n        fun.net.pListen('EnterRoom', this.onEnterRoomIn.bind(this));\n        fun.net.pListen('OffLine', this.onOffLineIn.bind(this));\n        fun.net.pListen('OnLine', this.onOnLineIn.bind(this));\n        fun.net.listen('DisbandRoom', this.onDisbandRoomIn.bind(this));\n        fun.net.listen('Ready', this.onReadyIn.bind(this));\n        fun.net.listen('ReadyNext', this.onReadyNextIn.bind(this));\n        fun.net.listen('DisbandRoomVote', this.onDisbandRoomVoteIn.bind(this));\n        fun.net.listen('DisbandRoomResult', this.onDisbandRoomResultIn.bind(this));\n        fun.net.listen('Banker', this.onBankerIn.bind(this));\n        fun.net.listen('RockCard', this.onRockCardIn.bind(this));\n        fun.net.listen('UserRefresh', this.onUserRefreshIn.bind(this));\n        fun.net.listen('NoneOps', this.onNoneOpsIn.bind(this));\n        fun.net.listen('StartGame', this.onStartGameIn.bind(this));\n        fun.net.listen('PlayCard', this.onPlayCardIn.bind(this));\n        fun.net.listen('DrawCard', this.onDrawCardIn.bind(this));\n        fun.net.listen('OpsAccept', this.onOpsAcceptIn.bind(this));\n        fun.net.listen('RepairCard', this.onRepairCardIn.bind(this));\n        fun.net.listen('OneAccount', this.onOneAccountIn.bind(this));\n        fun.net.listen('QuitRoom', this.onQuitRoomIn.bind(this));\n        fun.net.listen('AllAccount', this.onAllAccountIn.bind(this));\n\n        fun.event.add('gameMgrWahuaInitCompleted', 'wahuaInitCompleted', this.updateSeats.bind(this));\n        fun.event.add('gameMgrWahuaQuitFromSetting', 'wahuaQuitFromSetting', this.onBtnExitClick.bind(this));\n    },\n    removeListener() {\n        fun.net.rmPListen('EnterRoom');\n        fun.net.rmPListen('OffLine');\n        fun.net.rmPListen('OnLine');\n        fun.net.rmListen('DisbandRoom');\n        fun.net.rmListen('Ready');\n        fun.net.rmListen('ReadyNext');\n        fun.net.rmListen('DisbandRoomVote');\n        fun.net.rmListen('DisbandRoomResult');\n        fun.net.rmListen('Banker');\n        fun.net.rmListen('RockCard');\n        fun.net.rmListen('UserRefresh');\n        fun.net.rmListen('NoneOps');\n        fun.net.rmListen('StartGame');\n        fun.net.rmListen('PlayCard');\n        fun.net.rmListen('DrawCard');\n        fun.net.rmListen('OpsAccept');\n        fun.net.rmListen('RepairCard');\n        fun.net.rmListen('OneAccount');\n        fun.net.rmListen('QuitRoom');\n        fun.net.rmListen('AllAccount');\n\n        fun.event.remove('gameMgrWahuaInitCompleted');\n        fun.event.remove('gameMgrWahuaQuitFromSetting');\n    },\n\n    onDestroy() {\n        this.removeListener();\n        this._seat = [];\n        this._seatDir = [];\n    },\n\n    updateSeats(p) {\n        if (!p && p !== 0) return;\n        this._seat[p] = {};\n        this._seat[p].ui = this.node.getChildByName(this._seatDir[p]).getComponent('playerUiWahua');\n        this._seat[p].pos = p;\n        this._seat[p].id = this._seat[p].ui.data ? this._seat[p].ui.data.userId : undefined;\n        cc.log('--- this._seat: ', this._seat);\n    },\n\n    getSeatByUserId(id) {\n        for (let i=0; i<this._seat.length; ++i) {\n            if (this._seat[i] && this._seat[i].id && this._seat[i].id === id) {\n                return this._seat[i];\n            }\n        }\n    },\n\n    reconnet() {\n        let roomInfo = fun.db.getData('RoomInfo');\n        if(!roomInfo.userMap) return;\n        let selfReadyState = roomInfo.userMap[this._userId].currentState;\n        this.setReadyState(selfReadyState === 0 ? true : false);\n        if (roomInfo.roomRule.nowZhuangjia) {\n            this.setJiaWeiShow(roomInfo.roomRule.nowZhuangjia);\n        }\n\n    },\n\n    setReadyState(flag) {\n        this.btnReady.active = flag;\n        if (this._gameStatu === 1) return;\n        this.btnInvite.active = false;\n        this.btnExit.active = false;\n    },\n\n    setJiaWeiShow(id) {\n        let tSeat = this.getSeatByUserId(id);\n        let tPos = tSeat.pos;\n        let newSeat = new Array(); // 0-天家 1-地家 2-银牌 3-长三\n        for (let i=0; i<this._seat.length; ++i) {\n            if (this._seat[i]) {\n                let curPos = this._seat[i].pos;\n                let dir = 0;\n                let cha = curPos - tPos;\n                if (cha === 1 || cha === -3) {\n                    dir = 1;\n                } else if (cha === 2 || cha === -2) {\n                    dir = 2;\n                } else if (cha === 3 || cha === -1) {\n                    dir = 3;\n                } else {\n                    dir = 0;\n                }\n                newSeat[dir] = this._seat[i];\n            }\n        }\n        for (let dir=0; dir<newSeat.length; ++dir) {\n            if (newSeat[dir]) {\n                newSeat[dir].ui.setDirect(dir);\n            }\n        }\n    },\n\n    onBtnExitClick() {\n        if (this._gameStatu === 1) {\n            if (this._isRoomOwner) {\n                fun.net.send('DisbandRoom', {}, function(rsp) {\n                    cc.log('DisbandRoom-----------', rsp);\n                    this.exitRoom();\n                }.bind(this));\n            } else {\n                fun.net.send('QuitRoom', {}, function(rsp) {\n                    cc.log('QuitRoom---------', rsp);\n                    this.exitRoom();\n                }.bind(this));\n            }\n        } else {\n            fun.net.send('DisbandRoomVote', {applyStatu: 0}, function(rsp) {\n                cc.log('DisbandRoomVote--------', rsp);\n                this.exitRoom();\n            }.bind(this));\n        }\n    },\n\n    onBtnReadyClick() {\n        fun.net.send('Ready', {}, function(rsp) {\n            if (rsp.returnStatu && rsp.returnStatu === 1) {\n                let seat = this.getSeatByUserId(rsp.ready);\n                if (!seat) return;\n                seat.ui.showReady(true);\n                this.setReadyState(false);\n            }\n        }.bind(this));\n    },\n    onBtnInviteClick() {\n        cc.log('--- invite ---')\n    },\n\n    onEnterRoomIn(data) {\n        let roomInfo = fun.db.getData('RoomInfo');\n        if (!roomInfo.userMap) {\n            roomInfo.userMap = {};\n        }\n        for (const key in data.userOneMap) {\n            if (key === 'userId') {\n                roomInfo.userMap[data.userOneMap.userId] = data.userOneMap;\n                fun.db.setData('RoomInfo', roomInfo);\n                return;\n            }\n        }\n    },\n\n    onReadyIn(data) {\n        cc.log('onReadyIn--------', data);\n        if (!data.ready) return;\n        let seat = this.getSeatByUserId(data.ready);\n        if (!seat) return;\n        seat.ui.showReady(true);\n    },\n\n    onReadyNextIn(data) {\n        cc.log('onReadyNextIn--------', data);\n        this.setReadyState(true);\n    },\n\n    onBankerIn(data) {\n        cc.log('onBankerIn--------', data);\n        this._gameStatu = 2;\n        this.setJiaWeiShow(data.Zhuangjia);\n        this.node.getChildByName('roomDescScrollView').active = false;\n    },\n\n    onRockCardIn(data) {\n        cc.log('onRockCardIn--------', data);\n        let yzNode = this.node.getChildByName('yaozhang');\n        for (let i=0; i<data.rollChessDice.length; ++i) {\n            let yz = WhUtils.getCardById(data.rollChessDice[i]);\n            let yzCard = yzNode.getChildByName('card'+(i+1)).getComponent(cc.Sprite);\n            yzCard.spriteFrame = this.paiMianAltas.getSpriteFrame(yz);\n        }\n        let szCallback = function(){\n            yzNode.active = true;\n        };\n        let szCard = WhUtils.getCardById(data.rollChessDice[0]);\n        let szPoint = WhUtils.getSaiziPointByCard(szCard);\n        fun.event.dispatch('wahuaSaiziEnd', {point: szPoint, callback: szCallback});\n    },\n\n    onUserRefreshIn(data) {\n        cc.log('onUserRefreshIn--------', data);\n    },\n\n    onNoneOpsIn(data) {\n        cc.log('onNoneOpsIn--------', data);\n    },\n\n    onStartGameIn(data) {\n        cc.log('onStartGameIn--------', data);\n    },\n\n    onPlayCardIn(data) {\n        cc.log('onPlayCardIn--------', data);\n    },\n\n    onDrawCardIn(data) {\n        cc.log('onDrawCardIn--------', data);\n    },\n\n    onOpsAcceptIn(data) {\n        cc.log('onOpsAcceptIn--------', data);\n    },\n\n    onRepairCardIn(data) {\n        cc.log('onRepairCardIn--------', data);\n    },\n\n    onOneAccountIn(data) {\n        cc.log('onOneAccountIn--------', data);\n    },\n\n    onAllAccountIn(data) {\n        cc.log('onAllAccountIn--------', data);\n    },\n\n    onDisbandRoomIn(data) {\n        cc.log('onDisbandRoomIn--------', data);\n        this.exitRoom();\n    },\n\n    onQuitRoomIn(data) {\n        let roomInfo = fun.db.getData('RoomInfo');\n        delete roomInfo.userMap[data.userId];\n        fun.db.setData('RoomInfo', roomInfo);\n    },\n\n    onDisbandRoomVoteIn(data) {\n        cc.log('onDisbandRoomVoteIn--------', data);\n    },\n\n    onDisbandRoomResultIn(data) {\n        cc.log(\"DisbandRoomResult---------------\", data);\n    },\n\n    onOffLineIn(data) {\n        fun.event.dispatch('OffLineState', {flag: true, userId: parseInt(data.outLine)});\n    },\n\n    onOnLineIn(data) {\n        fun.event.dispatch('OffLineState', {flag: false, userId: parseInt(data.userId)});\n    },\n\n    exitRoom() {\n        let userInfo = fun.db.getData('UserInfo');\n        userInfo.RoomId = 0;\n        fun.db.setData('UserInfo', userInfo);\n        cc.director.loadScene('hall');\n    },\n\n});\n"]}