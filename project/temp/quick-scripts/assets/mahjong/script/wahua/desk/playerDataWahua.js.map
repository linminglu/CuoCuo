{"version":3,"sources":["playerDataWahua.js"],"names":["UIPos","cc","Enum","xia","you","shang","zuo","SeatDir","Class","extends","Component","properties","uiPos","type","default","onLoad","playerUi","node","getComponent","setWait","roomInfo","fun","db","getData","userMap","playerNum","roomRule","userInfo","userId","UserId","toString","userName","UserName","_userId","isUserMap","_sort","sort","setData","destroy","setPlayerUi","_enterRoomName","event","getSum","add","bind","_offLineStateName","onLineStateEvent","onDestroy","remove","data","key","parseInt","getUserId","showOffLine","flag"],"mappings":"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","file":"playerDataWahua.js","sourceRoot":"../../../../../../../assets/mahjong/script/wahua/desk","sourcesContent":["const UIPos = cc.Enum({\n    xia: 0,\n    you: 1,\n    shang: 2,\n    zuo: 3,\n});\nconst SeatDir = ['xia', 'you', 'shang', 'zuo'];\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        uiPos: {\n            type: UIPos,\n            default: UIPos.xia,\n        },\n    },\n\n    onLoad () {\n        this.playerUi = this.node.getComponent('playerUiWahua');\n        this.playerUi.setWait();\n        let roomInfo = fun.db.getData('RoomInfo');\n        let userMap = roomInfo.userMap;\n        let playerNum = roomInfo.roomRule.playerNum;\n        let userInfo = fun.db.getData('UserInfo');\n        userInfo.userId = userInfo.UserId.toString();\n        userInfo.userName = userInfo.UserName;\n        this._userId = userInfo.userId;\n        let isUserMap = (userMap && userMap[this._userId]) ? true : false;\n        this._sort = 0;\n        if (isUserMap) {\n            this._sort = userMap[this._userId].sort;\n        }\n        switch (this.uiPos) {\n            case UIPos.xia:\n                {\n                    if (isUserMap) {\n                        this.playerUi.setData(userMap[this._userId], this.uiPos);\n                    } else {\n                        this.playerUi.setData(userInfo, this.uiPos);\n                    }\n                }\n                break;\n            case UIPos.you:\n                if (playerNum === 2) {\n                    this.node.destroy();\n                    return;\n                } else {\n                    this._sort = (this._sort + 1) > (playerNum - 1) ? 0 : (this._sort + 1);\n                }\n                break;\n            case UIPos.shang:\n                if (playerNum === 2) {\n                    this._sort = (this._sort + 1) > (playerNum - 1) ? 0 : (this._sort + 1);\n                } else {\n                    this._sort = (this._sort + 2) > (playerNum - 1) ? ((this._sort + 2 - playerNum) === 2 ? 1 : 0) : (this._sort + 2);\n                }\n                break;\n            case UIPos.zuo:\n                if (playerNum < 4) {\n                    this.node.destroy();\n                    return;\n                } else {\n                    this._sort = (this._sort - 1) < 0 ? 3 : (this._sort - 1);\n                }\n                break;\n            default:\n                break;\n        }\n        if (userMap) {\n            this.setPlayerUi(roomInfo);\n        }\n        this._enterRoomName = 'RoomInfo' + fun.event.getSum();\n        fun.event.add(this._enterRoomName, 'RoomInfo', this.setPlayerUi.bind(this));\n        this._offLineStateName = 'OffLineState' + fun.event.getSum();\n        fun.event.add(this._offLineStateName, 'OffLineState', this.onLineStateEvent.bind(this));\n    },\n\n    onDestroy() {\n        fun.event.remove(this._enterRoomName);\n        fun.event.remove(this._offLineStateName);\n    },\n\n    setPlayerUi(data) {\n        for (const key in data.userMap) {\n            if (data.userMap[key].sort === this._sort) {\n                this._userId = parseInt(key);\n                this.playerUi.setData(data.userMap[key], this.uiPos);\n                return;\n            }\n        }\n    },\n\n    getUserId() {\n        return this._userId;\n    },\n\n    onLineStateEvent(data) {\n        if (data.userId === this._userId) {\n            this.playerUi.showOffLine(data.flag);\n        }\n    },\n});\n"]}