{"version":3,"sources":["mjPlayerPai.js"],"names":["GameDefine","require","log","cc","gameManager","mjPai","paiObjCls","setDeskType","posType","desPosType","createPai","id","new","createFullPai","pai","refreshCaiShen","refreshSort","creatPengGangPai","setShowType","PAISHOWTYPE","PENG","spliceShouShangPai","targetID","splicePai","handPaiList","getShouPaiList","i","length","curPai","splice","chi","paiData","chiData","d","isSelf","s","paiID","card","isSheng","sheng","rotateData","getEatPaiRotate","lastChuPaiDir","pengList","pengGangPai","all","push","spliceID","getSlipceID","index","unshift","PENGBY","addPengList","getCanChiData","paiid","shouPaiList","slice","count","curID","isExit","some","peng","rotate","pengCount","gang_0","gangList","forEach","item","setRotate","gang","gang_1","showTp","GAI","gang_2","changeIndex","addPai","chupaiDeskType","targetDest","checkPai","sortId","sortMajiang","sortGroupPai","cleanReplayData","sortPengGangPai","groupPai","self","sort","a","b","setShouPai","paiList","isGai","addShoupai","showType","SHOUGAI","faPai","faPaiList","uprightPai","SHOU","gaiAllPai","cleanFaPaiList","resetPengGangPai","resetPengGang","name","changeList","type","EATPAI_TYPE","AnGang","resetAngang","resetNorGangPeng","mjDataMgr","get","KEYS","POSIDS","chuPaiDesk","pId","temList","data","showPai","spliceIndex","findIndex","chuPai","buHuapai","idList","END","puhuaList","bind","udid","randomIndex","Math","floor","random","daPaiOutList","shouShangPai","init","hymjPai","chiID","wlmjPai","isChi","__proto__","call","hymjReplayPai","replayChupai","wlmjReplayPai","prototype","module","exports","isReplay","dfDataList","gameConst","gameType","maJiangWenLing","maJiangHuangYan","curGameType","fun","db","getData","GameType","curMjSys","paiObj"],"mappings":"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","file":"mjPlayerPai.js","sourceRoot":"../../../../../../../assets/mahjong/script/game/common","sourcesContent":["var GameDefine  = require(\"mjGameDefine\");\n// var utils       = require(\"utils\");\nvar log         = cc.log;\nvar gameManager = require(\"mjGameManager\");\nvar mjPai       = require(\"mjPai\");\n// /*\n// \t牌的数据结构\n// */\n\n\nvar paiObjCls =function(){\n\tthis.setDeskType = function(posType){\n\t\tthis.desPosType = posType;\n\t}\n\tthis.createPai = function(id){\n\t\treturn mjPai.new(id);\n\t}\n\tthis.createFullPai = function(id){\n\t\tvar pai = this.createPai(id);\n\t\tpai.refreshCaiShen();\n\t\tpai.refreshSort();\n\t\treturn pai;\n\t}\n\n\n\n\tthis.creatPengGangPai = function(id){\n\t\tvar pai = this.createFullPai(id);\n\t\tpai.setShowType(GameDefine.PAISHOWTYPE.PENG)\n\t\treturn pai;\n\t}\n\n\tthis.spliceShouShangPai = function(targetID){\n\t\tvar splicePai;\n\t\tvar handPaiList = this.getShouPaiList();\n\t\tfor(var i = handPaiList.length -1; i > -1; i--){\n\t\t\tlet curPai = handPaiList[i];\n\t\t\tif(curPai.id == targetID){\n\t\t\t\tsplicePai = handPaiList.splice(i, 1)[0];\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\treturn splicePai;\n\t}\n\n\t//碰牌\n\tthis.chi = function(paiData){\n\t\tlet chiData = paiData.d;\n\t\tlet isSelf  = paiData.s;\n\t\tlet paiID   = paiData.card;\n\t\tlet isSheng = paiData.sheng\n\t\tlog(\"THIS IS OLD chi\", chiData, paiID);\n\t\tvar rotateData = this.getEatPaiRotate(gameManager.lastChuPaiDir);\n\t\tvar pai = this.creatPengGangPai(paiID);\n\t\tvar pengList = []; \n\t\tthis.pengGangPai.all.push(pai);\n\t\tfor(let i = 0; i < 3; i++){\n\t\t\tif(chiData[i] == paiID){continue}\n\t\t\tvar spliceID = this.getSlipceID(isSelf, chiData[i]);\n\t\t\tlet splicePai = this.spliceShouShangPai(spliceID);\n\t\t\tsplicePai.id = chiData[i];\n\t\t\tthis.pengGangPai.all.push(splicePai);\n\t\t\tsplicePai.setShowType(GameDefine.PAISHOWTYPE.PENG)\n\t\t\tpengList.push(splicePai);\n\t\t}\n\t\tif(rotateData.index == 0){\n\t\t\tpengList.unshift(pai);\n\t\t}else {\n\t\t\tpengList.push(pai);\n\t\t}\n\t\tpengList[rotateData.index].setShowType(GameDefine.PAISHOWTYPE.PENGBY) \n\t\tthis.addPengList(pengList);\n\t\treturn pengList;\n\t}\n\n\tthis.getCanChiData = function(paiid){\n\t\tvar chiData = [];\n\t\tvar shouPaiList = this.getShouPaiList().slice();\n\t\tshouPaiList.push({id : paiid})\n\t\tfor(let id = paiid -2; id<(paiid +1) ; id++){\n\t\t\tvar count = 0;\n\t\t\tfor(let i=0; i < 3; i++){\n\t\t\t\tvar curID = id + i;\n\t\t\t\tvar isExit = shouPaiList.some(function(pai){\n\t\t\t\t\treturn pai.id == curID\n\t\t\t\t})\n\t\t\t\tif(isExit) {\n\t\t\t\t\tcount += 1;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif(count == 3){\n\t\t\t\tchiData.push([id, id+1, id+2]);\n\t\t\t}\n\t\t}\n\t\treturn chiData;\n\t}\n\n\tthis.addPengList = function(pengList){\n\t\tthis.pengGangPai.peng.push(pengList);\n\t}\n\t\n\n\t//碰牌\n\tthis.peng = function(paiID, isSelf){\n\t\tvar rotateData = this.getEatPaiRotate(gameManager.lastChuPaiDir);\n\t\tvar pai = this.creatPengGangPai(paiID);\n\t\tvar pengList = [pai]; \n\t\tvar targetID = this.getSlipceID(isSelf, pai.id);//isSelf ? pai.id : 0;\n\t\tlog(\"--targetID-------\", targetID);\n\t\tthis.pengGangPai.all.push(pai);\n\t\tfor(let i = 0 ; i < 2; i++){\n\n\t\t\tlet curPai = this.spliceShouShangPai(targetID);\n\t\t\tcurPai.id = pai.id;\n\t\t\tcurPai.setShowType(GameDefine.PAISHOWTYPE.PENG)\n\t\t\tpengList.push(curPai);\n\t\t\tthis.pengGangPai.all.push(curPai);\n\t\t\t\n\t\t}\n\t\tif(rotateData.rotate != 0){\n\t\t\tpengList[rotateData.index].setShowType(GameDefine.PAISHOWTYPE.PENGBY) \n\t\t}\n\t\tthis.addPengList(pengList);\n\t\tthis.pengCount += 1;\n\t\treturn pengList;\n\t}\n\n\t\n\n\t//杠牌， 从碰的拍上杠牌\n\tthis.gang_0 = function(id, isSelf){\n\t\tvar pai = this.creatPengGangPai(id);\n\t\tvar gangList = []; \n\t\tthis.pengGangPai.all.push(pai);\n\t\tfor(let i = 0; i < this.pengGangPai.peng.length; i++) {\n\t\t\tvar pengList = this.pengGangPai.peng[i];\n\t\t\tif(pengList[0].id === pai.id){\n\t\t\t\tgangList     = pengList;\n\t\t\t\tgangList.forEach(function(item){\n\t\t\t\t\titem.setRotate(0);\n\t\t\t\t})\n\t\t\t\tvar targetID = this.getSlipceID(isSelf, pai.id); //isSelf ? pai.id : 0;\n\t\t\t\tvar curPai   = this.spliceShouShangPai(targetID);\n\t\t\t\tcurPai.setShowType(GameDefine.PAISHOWTYPE.PENG);\n\t\t\t\tcurPai.id    = pai.id;\n\t\t\t\tgangList.push(curPai);\n\t\t\t\tthis.pengGangPai.peng.splice(i, 1);\n\t\t\t}\n\t\t}\n\t\tthis.pengGangPai.gang.push(gangList);\n\t\treturn gangList;\n\t}\n\n\t//暗杠\n\tthis.gang_1 = function(id, isSelf){\n\t\tvar gangList = []; \n\t\tvar targetID = this.getSlipceID(isSelf, id)//isSelf ? pai.id : 0;\n\t\tfor(let i = 0 ; i < 4; i++){\n\t\t\tlet curPai = this.spliceShouShangPai(targetID);\n\t\t\tcurPai.id  = id;\n\t\t\tvar showTp = (i < 3) ? GameDefine.PAISHOWTYPE.GAI : GameDefine.PAISHOWTYPE.PENG;\n\t\t\tcurPai.setShowType(showTp);\n\t\t\tgangList.push(curPai);\n\t\t\tthis.pengGangPai.all.push(curPai);\n\t\t}\n\t\tthis.pengGangPai.gang.push(gangList);\n\t\treturn gangList;\n\t},\n\n\t//杠牌， 自己手中有三张 杠别人打出来的牌 \n\tthis.gang_2 = function(id, isSelf){\n\t\tvar rotateData = this.getEatPaiRotate(gameManager.lastChuPaiDir);\n\t\tvar pai = this.creatPengGangPai(id);\n\t\tvar gangList = [pai]; \n\t\tvar targetID = this.getSlipceID(isSelf, pai.id)//isSelf ? pai.id : 0;\n\t\tthis.pengGangPai.all.push(pai);\n\t\tfor(let i = 0 ; i < 3; i++){\n\t\t\tlet curPai = this.spliceShouShangPai(targetID);\n\t\t\tcurPai.id = pai.id;\n\t\t\tcurPai.setShowType(GameDefine.PAISHOWTYPE.PENG);\n\t\t\tgangList.push(curPai);\n\t\t\tthis.pengGangPai.all.push(curPai);\n\t\t}\n\t\tvar changeIndex = (rotateData.rotate == 0) ? 3 : rotateData.index\n\t\tgangList[changeIndex].setShowType(GameDefine.PAISHOWTYPE.PENGBY);\n\t\tthis.pengGangPai.gang.push(gangList);\n\t\treturn gangList;\n\t}\n\n\tthis.addPai = function(id){\n\t\tcc.log(\"---this.addPai--\" + id);\n\t\tvar pai = this.createFullPai(id);\n\t\tvar shouPaiList = this.getShouPaiList();\n\t\tshouPaiList.push(pai);\n\t\treturn pai;\n\t}\n\n\n\tthis.getEatPaiRotate = function(chupaiDeskType){\n\t\tvar rotate = 90;\n\t\tfor(let i =1; i < 4; i++){\n\t\t\tvar targetDest = (this.desPosType + i) % 4;\n\t\t\tif(targetDest == chupaiDeskType) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\trotate -= 90;\n\t\t}\t\n\t\tvar index     = rotate > 0 ? 2 : 0;\n\t\treturn {rotate : rotate, index : index};\n\t}\n\n\n\tthis.checkPai   = function(pai){\n\t\tpai        = pai || {};\n\t\tpai.id     = pai.id || 0;\n\t\tpai.sortId = pai.sortId || 0;\n\t}, \n\t//手上的牌排序\n\tthis.sortMajiang = function() {\n\t\tvar shouPaiList = this.getShouPaiList();\n\t\tfor(let i =0; i < shouPaiList.length; i++){\n\t\t\tlet pai = shouPaiList[i];\n\t\t\tpai.refreshSort();\n\t\t\tpai.refreshCaiShen();\n\t\t}\n\t\tthis.sortGroupPai(shouPaiList); \n\t}\n\n\tthis.cleanReplayData = function(){\n\n\t}\n\n\tthis.sortPengGangPai = function(){\n\t\tvar gangList = this.pengGangPai.gang;\n\t\tfor(let i=0; i<gangList.length; i++){\n\t\t\tthis.sortGroupPai(gangList[i]);\n\t\t}\n\t\tvar pengList = this.pengGangPai.peng;\n\t\tfor(let i=0; i<pengList.length; i++){\n\t\t\tthis.sortGroupPai(pengList[i]);\n\t\t}\n\t}\n\n\tthis.sortGroupPai = function(groupPai){\n\t\tvar self = this;\n\t\tgroupPai.sort(function(a, b){\n\t\t\tself.checkPai(a);\n\t\t\tself.checkPai(b);\n\t\t\treturn a.sortId - b.sortId;\n\t\t})\n\t}\n\n\n\tthis.setShouPai = function(paiList, isGai){\n\t\tvar shouPaiList = this.getShouPaiList();\n\t\tvar addShoupai = [];\n\t\tfor(let i = 0; i<paiList.length; i++){\n\t\t\tvar pai = this.createPai(paiList[i]);\n\t\t\tshouPaiList.push(pai);\n\t\t\tpai.showType = isGai ? GameDefine.PAISHOWTYPE.SHOUGAI : pai.showType;\n\t\t\taddShoupai.push(pai)\n\t\t}\n\t\treturn addShoupai;\n\t}\n\n\tthis.faPai = function(paiList, isGai){\n\t\tvar addShoupai = [];\n\t\tfor(let i = 0; i<paiList.length; i++){\n\t\t\tvar pai = this.createPai(paiList[i]);\n\t\t\tthis.faPaiList.push(pai);\n\t\t\tpai.showType = isGai ? GameDefine.PAISHOWTYPE.SHOUGAI : pai.showType;\n\t\t\taddShoupai.push(pai)\n\t\t}\n\t\treturn addShoupai;\n\t}\n\n\tthis.uprightPai  = function(){\n\t\tfor(let i = 0; i< this.faPaiList.length; i++){\n\t\t\tthis.faPaiList[i].showType = GameDefine.PAISHOWTYPE.SHOU;\n\t\t}\n\t}\n\t\n\tthis.gaiAllPai = function(){\n\t\tfor(let i = 0; i<this.faPaiList.length; i++){\n\t\t\tlet pai = this.faPaiList[i];\n\t\t\tpai.refreshSort();\n\t\t\tpai.refreshCaiShen();\n\t\t\tthis.faPaiList[i].showType = GameDefine.PAISHOWTYPE.SHOUGAI;\n\t\t}\n\t\tthis.sortGroupPai(this.faPaiList); \n\t}\n\n\tthis.cleanFaPaiList = function(){\n\t\tthis.faPaiList = [];\n\t}\n\n\tthis.resetPengGangPai = function(gangList, pengList){\n\t\tthis.resetPengGang(\"gang\", gangList);\n\t\tthis.resetPengGang(\"peng\", pengList);\n\t}\n\n\tthis.resetPengGang = function(name, paiList){\n\t\tpaiList = paiList || [];\n\t\tvar self = this;\n\t\tvar changeList = [];\n\t\tpaiList.forEach(function(item){\n\t\t\tif(item.type == GameDefine.EATPAI_TYPE.AnGang){\n\t\t\t\tchangeList.push(self.resetAngang(item))\n\t\t\t}else {\n\t\t\t\tchangeList.push(self.resetNorGangPeng(item));\n\t\t\t}\n\t\t})\n\t\tthis.pengGangPai[name] = changeList;\n\t}\n\n\tthis.resetNorGangPeng  = function(item){\n\t\tvar self = this;\n\t\tvar mjDataMgr = require(\"mjDataMgr\");\n\t\tvar s = mjDataMgr.get(mjDataMgr.KEYS.POSIDS);\n\t\tvar chuPaiDesk = mjDataMgr.get(mjDataMgr.KEYS.POSIDS)[item.pId];\n\t\t\tvar rotateData = self.getEatPaiRotate(chuPaiDesk);\n\t\t\tvar temList = [];\n\t\t\titem.data.forEach(function(id){\n\t\t\t\tvar pai = self.creatPengGangPai(id);\n\t\t\t\ttemList.push(pai);\n\t\t\t\tself.pengGangPai.all.push(pai);\n\t\t\t})\n\t\t\tif(rotateData.rotate != 0){\n\t\t\t\ttemList[rotateData.index].setShowType(GameDefine.PAISHOWTYPE.PENGBY);\n\t\t\t}\n\t\treturn temList;\n\t}\n\n\tthis.resetAngang = function(item){\n\t\tvar self = this;\n\t\tvar temList = [];\n\t\titem.data.forEach(function(id, index){\n\t\t\tvar pai = self.createFullPai(id);\n\t\t\tvar showType = (index < 3) ? GameDefine.PAISHOWTYPE.GAI : GameDefine.PAISHOWTYPE.PENG;\n\t\t\tpai.setShowType(showType)\n\t\t\ttemList.push(pai);\n\t\t\tself.pengGangPai.all.push(pai);\n\t\t})\n\t\treturn temList;\n\t}\n\n\tthis.showPai = function(paiid){\n\t\tvar handPaiList = this.getShouPaiList();\n\t\tvar spliceIndex = handPaiList.findIndex(function(item){\n\t\t\treturn (item.id == paiid);\n\t\t}) \n\t\tvar chuPai = handPaiList.splice(spliceIndex, 1)[0];\n\t\treturn chuPai;\n\t}\n\n\tthis.buHuapai = function(idList){\n\t\tidList.forEach(function(id){\n\t\t\tvar pai = this.createFullPai(id);\n\t\t\tpai.setShowType(GameDefine.PAISHOWTYPE.END);\n\t\t\tthis.puhuaList.push(pai);\n\t\t}.bind(this))\n\t},\n\n\t//从pai obj中移出pai\n\tthis.chuPai = function(udid, paiid){\n\t\tvar handPaiList = this.getShouPaiList();\n\t\tvar spliceIndex = handPaiList.findIndex(function(item){\n\t\t\treturn (item.udid == udid);\n\t\t}) \n\t\tvar randomIndex = Math.floor(Math.random() * handPaiList.length);\n\t\tspliceIndex = spliceIndex == -1 ? randomIndex : spliceIndex;\n\t\tvar chuPai = handPaiList.splice(spliceIndex, 1)[0];\n\t\tthis.daPaiOutList.push(chuPai);\n\t\treturn chuPai;\n\t}\n\tthis.getShouPaiList = function(){\n\t\treturn this.shouShangPai;\n\t}\n\tthis.init = function(){\n\t\tthis.pengCount        = 0; //碰的牌\n\t\tthis.shouShangPai     = []; //手上没有碰和杠的牌\n\t\tthis.faPaiList        = []; //发牌只做动画显示，显示完毕后清空\n\t\tthis.pengGangPai      = {};\n\t\tthis.pengGangPai.all  = []; //碰和杠出去的牌\n\t\tthis.pengGangPai.peng = []; //碰出去的牌\n\t\tthis.pengGangPai.gang = []; //杠出去的牌\n\t\tthis.daPaiOutList     = []; //打出去没有被人吃的牌\n\t\tthis.puhuaList        = [];\n\t}\n}\n//黄岩麻将\t\nvar hymjPai = function(){\n\tthis.puhuaList        = [];\n\tthis.getSlipceID = function(isSelf, chiID){\n\t\treturn (isSelf ? chiID : 0 );\n\t}\n} \n\n//温岭麻将\t\nvar wlmjPai = function(){\n\t\n\tthis.getSlipceID = function(isSelf, chiID){\n\t\treturn (isSelf ? chiID : 0 );\n\t}\n\n\t//碰牌\n\tthis.peng = function(paiID, isSelf){\n\t\tvar pai = this.creatPengGangPai(paiID);\n\t\tvar pengList = [pai]; \n\t\tvar targetID = this.getSlipceID(isSelf, pai.id);//isSelf ? pai.id : 0;\n\t\tthis.pengGangPai.all.push(pai);\n\t\tfor(let i = 0 ; i < 2; i++){\n\n\t\t\tlet curPai = this.spliceShouShangPai(targetID);\n\t\t\tcurPai.id = pai.id;\n\t\t\tcurPai.setShowType(GameDefine.PAISHOWTYPE.PENG)\n\t\t\tpengList.push(curPai);\n\t\t\tthis.pengGangPai.all.push(curPai);\n\t\t\t\n\t\t}\n\t\tthis.addPengList(pengList);\n\t\tthis.pengCount += 1;\n\t\treturn pengList;\n\t}\n\n\t//杠牌， 自己手中有三张 杠别人打出来的牌 \n\tthis.gang_2 = function(id, isSelf){\n\t\tvar pai = this.creatPengGangPai(id);\n\t\tvar gangList = [pai]; \n\t\tvar targetID = this.getSlipceID(isSelf, pai.id)//isSelf ? pai.id : 0;\n\t\tthis.pengGangPai.all.push(pai);\n\t\tfor(let i = 0 ; i < 3; i++){\n\t\t\tlet curPai = this.spliceShouShangPai(targetID);\n\t\t\tcurPai.id = pai.id;\n\t\t\tcurPai.setShowType(GameDefine.PAISHOWTYPE.PENG);\n\t\t\tgangList.push(curPai);\n\t\t\tthis.pengGangPai.all.push(curPai);\n\t\t}\n\t\t// gangList[3].setShowType(GameDefine.PAISHOWTYPE.PENGBY);\n\t\tthis.pengGangPai.gang.push(gangList);\n\t\treturn gangList;\n\t}\n\n\t// //吃\n\t// this.chi = function(paiData){\n\t// \tlet chiData = paiData.d;\n\t// \tlet isSelf  = paiData.s;\n\t// \tlet paiID   = paiData.card;\n\t// \tlet isSheng = paiData.sheng\n\t// \tif(isSheng){\n\t// \t\treturn \tthis.__proto__.chi(paiData);\n\t// \t}\n\t// \tvar pai = this.creatPengGangPai(paiID);\n\t// \tvar pengList = []; \n\t// \tthis.pengGangPai.all.push(pai);\n\t// \tfor(let i = 0; i < 3; i++){\n\t// \t\tif(chiData[i] == paiID){continue}\n\t// \t\tvar spliceID = this.getSlipceID(isSelf, chiData[i]);\n\t// \t\tlet splicePai = this.spliceShouShangPai(spliceID);\n\t// \t\tsplicePai.id = chiData[i];\n\t// \t\tthis.pengGangPai.all.push(splicePai);\n\t// \t\tsplicePai.setShowType(GameDefine.PAISHOWTYPE.PENG)\n\t// \t\tpengList.push(splicePai);\n\t// \t}\n\t// \tpengList.push(pai);\n\t// \tpengList.sort(function(a, b){\n\t// \t\treturn a.id - b.id;\n\t// \t})\n\t// \tthis.addPengList(pengList);\n\t// \treturn pengList;\n\t// }\n\n\n\tthis.resetNorGangPeng  = function(item){\n\t\tlet isChi = item.data[0] != item.data[1];\n\t\tif(isChi){\n\t\t\treturn this.__proto__.resetNorGangPeng.call(this, item);\n\t\t}\n\t\tvar self = this;\n\t\tvar mjDataMgr = require(\"mjDataMgr\");\n\t\tvar chuPaiDesk = mjDataMgr.get(mjDataMgr.KEYS.POSIDS)[item.pId];\n\t\t\tvar rotateData = self.getEatPaiRotate(chuPaiDesk);\n\t\t\tvar temList = [];\n\t\t\titem.data.forEach(function(id){\n\t\t\t\tvar pai = self.creatPengGangPai(id);\n\t\t\t\ttemList.push(pai);\n\t\t\t\tself.pengGangPai.all.push(pai);\n\t\t\t})\n\t\treturn temList;\n\t}\n\n\n} \n\n//黄岩麻将回放\nvar hymjReplayPai = function(){\n\tthis.puhuaList        = [];\n\t// this.getShouPaiList = function(){\n\t// \t//回放时候的手上牌\n\t// \tvar pengLen = this.pengGangPai.peng.length;\n\t// \treturn this.pengGangPai.peng[pengLen - 1];\n\t// }\n\n\tthis.getSlipceID = function(isSelf, chiID){\n\t\treturn chiID;\n\t}\n\t\n\n\n\tthis.replayChupai = function(paiID){\n\t\tvar handPaiList = this.getShouPaiList();\n\t\tvar spliceIndex = handPaiList.findIndex(function(item){\n\t\t\treturn item.id == paiID;\n\t\t});\n\t\tspliceIndex = spliceIndex == -1 ? 0 : spliceIndex;\t\t\n\t\tvar chuPai = handPaiList.splice(spliceIndex, 1)[0];\n\t\tthis.daPaiOutList.push(chuPai);\n\t\treturn chuPai;\n\t}\n\t\n\t//从pai obj中移出pai\n\tthis.chuPai = function(udid, paiID){\n\t\treturn this.replayChupai(paiID);\n\t}\n\tthis.cleanReplayData = function(){\n\t}\n\n\tthis.setShouPai = function(paiList){\n\t\tvar shouPaiList = this.getShouPaiList();\n\t\tvar addShoupai = [];\n\t\tfor(let i = 0; i<paiList.length; i++){\n\t\t\tvar pai = this.createPai(paiList[i]);\n\t\t\tpai.setShowType(GameDefine.PAISHOWTYPE.PENG);\n\t\t\tshouPaiList.push(pai);\n\t\t\taddShoupai.push(pai)\n\t\t}\n\t\treturn addShoupai;\n\t}\n\n\tthis.addPai = function(id){\n\t\tvar pai = this.createFullPai(id);\n\t\tpai.setShowType(GameDefine.PAISHOWTYPE.PENG);\n\t\tvar shouPaiList = this.getShouPaiList();\n\t\tshouPaiList.push(pai);\n\t\treturn pai;\n\t}\n}\n\nvar wlmjReplayPai = function(){\n\tthis.puhuaList        = [];\n\tthis.getSlipceID = function(isSelf, chiID){\n\t\treturn chiID;\n\t}\n\n\tthis.replayChupai = function(paiID){\n\t\tvar handPaiList = this.getShouPaiList();\n\t\tvar spliceIndex = handPaiList.findIndex(function(item){\n\t\t\treturn item.id == paiID;\n\t\t});\n\t\tspliceIndex = spliceIndex == -1 ? 0 : spliceIndex;\t\t\n\t\tvar chuPai = handPaiList.splice(spliceIndex, 1)[0];\n\t\tthis.daPaiOutList.push(chuPai);\n\t\treturn chuPai;\n\t}\n\t\n\t//从pai obj中移出pai\n\tthis.chuPai = function(udid, paiID){\n\t\treturn this.replayChupai(paiID);\n\t}\n\tthis.cleanReplayData = function(){\n\t}\n\n\tthis.setShouPai = function(paiList){\n\t\tvar shouPaiList = this.getShouPaiList();\n\t\tvar addShoupai = [];\n\t\tfor(let i = 0; i<paiList.length; i++){\n\t\t\tvar pai = this.createPai(paiList[i]);\n\t\t\tpai.setShowType(GameDefine.PAISHOWTYPE.PENG);\n\t\t\tshouPaiList.push(pai);\n\t\t\taddShoupai.push(pai)\n\t\t}\n\t\treturn addShoupai;\n\t}\n\n\tthis.addPai = function(id){\n\t\tvar pai = this.createFullPai(id);\n\t\tpai.setShowType(GameDefine.PAISHOWTYPE.PENG);\n\t\tvar shouPaiList = this.getShouPaiList();\n\t\tshouPaiList.push(pai);\n\t\treturn pai;\n\t}\n\n\n\t\n}\n\n\n//添加继承 \nhymjPai.prototype       = new paiObjCls();\nwlmjPai.prototype       = new paiObjCls();\nhymjReplayPai.prototype = new paiObjCls();\nwlmjReplayPai.prototype = new wlmjPai();\n\nmodule.exports = {\n\tnew : function(isReplay=false){\n\t\tvar dfDataList                                          = {}\n\t\tdfDataList[gameConst.gameType.maJiangWenLing + \"false\"] =  wlmjPai;\n\t\tdfDataList[gameConst.gameType.maJiangHuangYan+ \"false\"] =  hymjPai;\n\t\tdfDataList[gameConst.gameType.maJiangWenLing + \"true\"]  =  wlmjReplayPai;\n\t\tdfDataList[gameConst.gameType.maJiangHuangYan+ \"true\"]  =  hymjReplayPai;\n\t\tvar curGameType = fun.db.getData('RoomInfo').GameType\n\t\tisReplay        = isReplay + \"\";\n\t\tvar curMjSys    = dfDataList[curGameType+isReplay];\n        var paiObj;\n        if(curMjSys){\n        \tpaiObj = new curMjSys();\n        \tpaiObj.init();\n        }else {\n        \tfun.log(\"mj\", \"mjPlayerPai new : curGameType: \" + curGameType + \"isReplay:\"+isReplay +\" has no defined\");\n        }\n\t\treturn paiObj;\n\t\t// return new paiObjCls(paiList);\n\t}\n}"]}