{"version":3,"sources":["mjReconnectMgr.js"],"names":["ReconnectMgr","GameDefine","require","log","cc","initLoginData","data","roomId","RoomId","needEnterRoom","reconneting","addPaiListener","mjNetMgr","getIns","addRebNet","KEYS","REB","rmPaisyncListener","rmNet","initDeskPaiData","paiData","needSetPaiju","deskPaiData","Infos","wlReconnected","setWLPaiData","startPlay","gameManager","mjDataMgr","mUid","get","UID","startPai","TileCount","dadePai","pengPai","gangPai","fanPai","UserId","Players","idx","parseInt","getplayerByUserID","PlayerIdx","paiInfo","len","Hand","shift","Mo","push","Tiles","Da","Fan","pengList","gangList","Chi","Peng","forEach","chiItem","lastIdx","pId","pengItem","AnGang","gangItem","type","EATPAI_TYPE","MingGang","isBegin","roomInfo","ROOMINFO","fapaiMo","initStartPai","zhuangNotify","Zhuang","Round","Quan","CaiShenPai","CaiShen","ReconnentData","paiOutList","ChuPlayer","LastCard","ChuStatus","Type","CurrentChuTile","Card","weiCount","reSetLeft","Left","setNormalPaiData","SelfCurrentTiles","totalOutPai","k","TileInfos","HandTileCount","ChuTilesInfo","length","ZHInfo","chi","concat","peng","sort","a","b","order","minggang","fun","utils","item","MingGang1","angang","JokerTile","meDirection","SelfFeng","leftPaiCount","LeftShuTileCount","LeftShengTileCount","LeftGangTileCount","curReportData","getReportData","AllZhanJiInfo","FinishGameCount","event","dispatch","initGameCount","onPaiTimeChange","Time","refrePlayerXdhs","getDeskPaiData","isReconneting","reConnectEnd","isNeedSetPaiju","checkGotoRoom","getRoomID","sendFucn","env","enteredRoom","checkPaiData","newRound","reSetResidue","reSetDadePai","reSetPengGangPai","reSetPlayerStatus","reserFanPai","initRoundData","gameUICB","setCaiShenPai","faPaiNoAnim","showReduceNode","reConnectInGameUI","addReconentMessageCB","addReaNet","REA","rmReconentMessageCB","loginEnd","inGmaeEnteredRoom","RoomInformation","RoomID","ROOMID","set","getInstance","initRoomPlayers","PlayersInfo","destPos","player","playerList","refreshData","initPlayerStatus","inGmaeSyncData","allzj","gameJuCount","zhuangIndex","isZhuangJia","i","lastZhuang","isWin","ishu","iszm","module","exports"],"mappings":"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","file":"mjReconnectMgr.js","sourceRoot":"../../../../../../../assets/mahjong/script/game/common","sourcesContent":["var ReconnectMgr    = {};\n// var NetMessageMgr   = require(\"NetMessageMgr\");\n// var NetProtocolList = require(\"NetProtocolList\");\n\nvar GameDefine      = require(\"mjGameDefine\");\n\nvar log             = cc.log;\n\n\nReconnectMgr.initLoginData = function(data){\n\tthis.roomId    = data.RoomId || 0;\n\tthis.needEnterRoom = (data.RoomId != 0);\n\tthis.reconneting   = (data.RoomId != 0);\n}\n\nReconnectMgr.addPaiListener = function(){\n\tvar mjNetMgr = require(\"mjNetMgr\")\n\tmjNetMgr.getIns().addRebNet(mjNetMgr.KEYS.REB, this);\n}\n\nReconnectMgr.rmPaisyncListener = function(){\n\tvar mjNetMgr = require(\"mjNetMgr\")\n\tmjNetMgr.getIns().rmNet(mjNetMgr.KEYS.REB);\n}\n\nReconnectMgr.initDeskPaiData = function(paiData){\n\tthis.rmPaisyncListener();\n\tthis.needSetPaiju= true;\n\tthis.deskPaiData = paiData.Infos;\n}\n\nReconnectMgr.wlReconnected = function(paiData){\n\tthis.deskPaiData = paiData;\n\tthis.setWLPaiData();\n\tthis.startPlay();\t\n}\n\n\n\n\nReconnectMgr.setWLPaiData = function(){\n\tvar gameManager = require(\"mjGameManager\");\n\tvar mjDataMgr   = require(\"mjDataMgr\");\n\tvar GameDefine      = require(\"mjGameDefine\");\n\tvar mUid        = mjDataMgr.get(mjDataMgr.KEYS.UID);\n\n\tvar startPai       = {};\n\tvar paiData        = this.deskPaiData;\n\tstartPai.TileCount = [];\n\t//\n\tvar dadePai        = [];\n\tvar pengPai        = [];\n\tvar gangPai        = [];\n\tvar fanPai         = [];\n\n\t//peng and chi belong to pengPai;\n\t\n\t\n\t\n\tfor(let UserId in paiData.Players){\n\t\t// cc.log(\"----------------reconnect ------------UserId:\"+ UserId,  paiData.Players[UserId], gameManager.getplayerByUserID(UserId));\n\t\tvar idx     = parseInt(gameManager.getplayerByUserID(UserId).PlayerIdx);\n\t\tlet paiInfo = paiData.Players[UserId];\n\t\tvar len     = paiInfo.Hand.shift();\n\t\tif(paiInfo.Mo){\n\t\t\tpaiInfo.Hand.push(paiInfo.Mo);\n\t\t}\n\t\tstartPai.TileCount[idx] = len;\n\t\tif(UserId == mUid){\n\t\t\tstartPai.Tiles = paiInfo.Hand;\n\t\t}\n\t\tdadePai[idx] = paiInfo.Da || [];\n\t\tfanPai[idx]  = paiInfo.Fan ||[];\n\t\tvar pengList     = [];\n\t\tvar gangList    = [];\n\t\tpaiInfo.Chi  = paiInfo.Chi || [];\n\t\tpaiInfo.Peng  = paiInfo.Peng || [];\n\n\t\tpaiInfo.Chi.forEach(function(chiItem){\n\t\t\tvar lastIdx = (idx + 3) % 4;\n\t\t\tpengList.push({pId: lastIdx, data : chiItem});\n\t\t})\n\n\t\tpaiInfo.Peng.forEach(function(pengItem){\n\t\t\tvar lastIdx = (idx + 2) % 4;\n\t\t\tpengList.push({pId: lastIdx, data : [pengItem, pengItem, pengItem]});\n\t\t})\n\t\tpengPai[idx] = pengList;\n\n\t\tpaiInfo.AnGang = paiInfo.AnGang || [];\n\t\tpaiInfo.AnGang.forEach(function(gangItem){\n\t\t\tgangList.push({pId: idx, data:[gangItem, gangItem, gangItem, gangItem], type: GameDefine.EATPAI_TYPE.AnGang});\n\t\t})\n\t\tpaiInfo.MingGang = paiInfo.MingGang ||[];\n\t\tpaiInfo.MingGang.forEach(function(gangItem){\n\t\t\tgangList.push({pId: idx, data:[gangItem, gangItem, gangItem, gangItem]});\n\t\t})\n\t\tgangPai[idx] = gangList;\n\n\t\t// var gangList = paiInfo.AnGang || [];\n\t\t// gangList = gangList.concat(paiInfo.MingGang)\n\t\t// gangPai.push(gangList);\n\t}\n\t\n\tthis.isBegin = false;\n\tvar roomInfo =  mjDataMgr.get(mjDataMgr.KEYS.ROOMINFO);\n\tgameManager.fapaiMo                      = true;\n\tgameManager.initStartPai(startPai);\n\tgameManager.zhuangNotify({UserId : paiData.Zhuang, Round: roomInfo.Round, Quan:roomInfo.Quan});\n\tgameManager.CaiShenPai                   = paiData.CaiShen;\n\tgameManager.ReconnentData                = {};\n\tgameManager.ReconnentData.paiOutList     = dadePai;\n\tgameManager.ReconnentData.pengPai        = pengPai;\n\tgameManager.ReconnentData.gangPai        = gangPai;\n\tgameManager.ReconnentData.fanPai         = fanPai;\n\tgameManager.ReconnentData.ChuPlayer      = gameManager.getplayerByUserID(paiData.LastCard.UserId).PlayerIdx;\n\tgameManager.ReconnentData.ChuStatus      = paiData.LastCard.Type;\n\tgameManager.ReconnentData.CurrentChuTile = paiData.LastCard.Card;\n\t// fun.event.dispatch(\"resetReportData\", []);\n\tgameManager.ReconnentData.weiCount       = 0; //paiData.LeftGangTileCount;\n\tgameManager.ReconnentData.reSetLeft      = paiData.Left;\n\n\n}\n\nReconnectMgr.setNormalPaiData = function(){\n\tvar gameManager     = require(\"mjGameManager\");\n\tvar mjDataMgr      = require(\"mjDataMgr\");\n\tvar startPai       = {};\n\tvar paiData        = this.deskPaiData;\n\tstartPai.TileCount = [];\n\tstartPai.Tiles     = paiData.SelfCurrentTiles;\n\tvar dadePai        = [];\n\tvar pengPai        = [];\n\tvar gangPai        = [];\n\tvar totalOutPai    = 0;\n\n\t//peng and chi belong to pengPai;\n\tfor(let k in paiData.TileInfos){\n\t\tlet paiInfo = paiData.TileInfos[k];\n\t\tstartPai.TileCount.push(paiInfo.HandTileCount);\n\t\tpaiInfo.ChuTilesInfo = paiInfo.ChuTilesInfo || [];\n\t\tdadePai.push(paiInfo.ChuTilesInfo);\n\t\ttotalOutPai += paiInfo.ChuTilesInfo.length;\n\t\tvar pengList =[];\n\t\tif(paiInfo.ZHInfo.chi){\n\t\t\ttotalOutPai += paiInfo.ZHInfo.chi.length;\n\t\t\tpengList = pengList.concat(paiInfo.ZHInfo.chi)\n\t\t}\n\t\tif(paiInfo.ZHInfo.peng){\n\t\t\ttotalOutPai += paiInfo.ZHInfo.peng.length;\n\t\t\tpengList = pengList.concat(paiInfo.ZHInfo.peng)\n\t\t}\n\t\tpengList.sort(function(a, b){\n\t\t\treturn a.order - b.order;\n\t\t})\n\t\tpengPai.push(pengList);\n\t\tvar gangList = [];\n\t\tif(paiInfo.ZHInfo.minggang){\n\t\t\ttotalOutPai += paiInfo.ZHInfo.minggang.length;\n\t\t\tfun.utils.forEach(paiInfo.ZHInfo.minggang, function(item){\n\t\t\t\titem.type = GameDefine.EATPAI_TYPE.MingGang1;\n\t\t\t})\n\t\t\tgangList = gangList.concat(paiInfo.ZHInfo.minggang)\n\t\t}\n\t\tif(paiInfo.ZHInfo.angang){\n\t\t\ttotalOutPai += paiInfo.ZHInfo.angang.length;\n\t\t\tfun.utils.forEach(paiInfo.ZHInfo.angang, function(item){\n\t\t\t\titem.type = GameDefine.EATPAI_TYPE.AnGang\n\t\t\t})\n\t\t\tgangList = gangList.concat(paiInfo.ZHInfo.angang);\n\t\t}\n\t\tgangList.sort(function(a, b){\n\t\t\treturn a.order - b.order;\n\t\t})\n\t\tgangPai.push(gangList);\n\n\t}\n\t\n\t\n\t// this.isBegin = (totalOutPai == 0);\n\tthis.isBegin = false;\n\tgameManager.initStartPai(startPai);\n\tgameManager.CaiShenPai               = [paiData.JokerTile];\n\tgameManager.meDirection              = paiData.SelfFeng;\n\tgameManager.ReconnentData            = {};\n\tvar leftPaiCount = (paiData.LeftShuTileCount + \n\t\tpaiData.LeftShengTileCount + paiData.LeftGangTileCount)\t\n\tgameManager.ReconnentData.reSetLeft      = leftPaiCount;\n\tgameManager.ReconnentData.weiCount       = paiData.LeftGangTileCount;\n\tgameManager.ReconnentData.paiOutList     = dadePai;\n\tgameManager.ReconnentData.pengPai        = pengPai;\n\tgameManager.ReconnentData.gangPai        = gangPai;\n\tgameManager.ReconnentData.ChuPlayer      = paiData.ChuPlayer;\n\tgameManager.ReconnentData.ChuStatus      = paiData.ChuStatus;\n\tgameManager.ReconnentData.CurrentChuTile = paiData.CurrentChuTile;\n\tvar curReportData                = this.getReportData(paiData.AllZhanJiInfo);\n\t// gameManager.playCount                    = paiData.FinishGameCount  || 0;\n\tvar roomInfo   =  mjDataMgr.get(mjDataMgr.KEYS.ROOMINFO);\n\troomInfo.Quan  = paiData.FinishGameCount  || 0;\n\troomInfo.Round = curReportData.length + 1;\n\tfun.event.dispatch(\"resetReportData\", curReportData);\n\tgameManager.initGameCount();\n\tif(paiData.LeftShuTileCount == 0){\n\t\tgameManager.onPaiTimeChange({Time:1});\n\t}\n\tgameManager.refrePlayerXdhs(curReportData);\n}\n\n\n\n\n\n\n\n\nReconnectMgr.getDeskPaiData = function(){\n\treturn this.deskPaiData;\n}\n\nReconnectMgr.isReconneting = function(){\n\treturn this.reconneting;\n}\nReconnectMgr.reConnectEnd  = function(){\n\tthis.reconneting = false;\n\tthis.needSetPaiju= false;\n}\n\nReconnectMgr.isNeedSetPaiju = function(){\n\tcc.log(\"----isNeedSetPaiju----this.needSetPaiju;--\", this.needSetPaiju)\n\treturn this.needSetPaiju;\n}\n\nReconnectMgr.checkGotoRoom = function(){\n\treturn this.needEnterRoom;\n}\n\nReconnectMgr.getRoomID  = function(sendFucn, env){\n\treturn this.roomId;\n}\n\nReconnectMgr.enteredRoom = function(){\n\tthis.needEnterRoom = false;\n}\n\nReconnectMgr.checkPaiData = function(){\n\n}\n\nReconnectMgr.startPlay = function(){\n\tvar gameManager     = require(\"mjGameManager\");\n\tthis.newRound();\n    gameManager.reSetResidue();\n    gameManager.reSetDadePai();\n    gameManager.reSetPengGangPai();\n    gameManager.reSetPlayerStatus();\n    gameManager.reserFanPai();\n}\n\n//equal to gameManager newRound\nReconnectMgr.newRound = function(){\n\tvar gameManager     = require(\"mjGameManager\");\n\tgameManager.initRoundData();\n\tgameManager.gameUICB.setCaiShenPai(gameManager.CaiShenPai);\n\tgameManager.faPaiNoAnim(this.isBegin);\n\tgameManager.gameUICB.showReduceNode();\n}\n\n\n/*------------------- START -------IN  GameUI Reconnect -----------------*/\n\nReconnectMgr.reConnectInGameUI = function(){\n\t// var UserLocalData = require(\"UserLocalData\");\n\t// NetMessageMgr.send(UserLocalData.CurloginID, UserLocalData.CurloginData, undefined, true, \"重新连接中……\");\n}\n\n\nReconnectMgr.addReconentMessageCB = function(){\n\tvar mjNetMgr = require(\"mjNetMgr\")\n\tmjNetMgr.getIns().addReaNet(mjNetMgr.KEYS.REA, this);\n}\n\nReconnectMgr.rmReconentMessageCB = function(){\n\tvar mjNetMgr = require(\"mjNetMgr\")\n\tmjNetMgr.getIns().rmNet(mjNetMgr.KEYS.REA);\n}\n\nReconnectMgr.loginEnd = function(data){\n\t// var gameManager     = require(\"mjGameManager\");\n\t// if(data.RetCode && (data.RetCode == 3 || data.RetCode == 1)){\n //        fun.utils.restart();\n //        return \n //    }\n //    var errorCB = function(errorTip){\n //    \terrorTip = errorTip || \"房间不存在\";\n //    \tNetMessageMgr.showTips(errorTip);\n //    \tsetTimeout(function(){\n //    \t\tgameManager.exiteRoom();\n //    \t}, 1000);\n //    }\n //    var roomID    = data.RoomId;\n //    if(!roomID || roomID < 1){\n //    \terrorCB();\n //    \treturn\n //    }\n\t\n\t// var UserLocalData   = require(\"UserLocalData\");\n\t// var mjDataMgr = require(\"mjDataMgr\");\n\t// mjDataMgr.set(mjDataMgr.KEYS.ROOMID, roomID);\n //    var sendData = {\n //        PlayerID : UserLocalData.getUserID(),//玩家帐号\n //        RoomID   : roomID,//房间id\n //    }\n //    NetMessageMgr.send(NetProtocolList.EnterRoomMessageNum.netID, sendData, errorCB, true, \"重新连接中……\");\n}\n\nReconnectMgr.inGmaeEnteredRoom = function(data){\n\tvar gameManager     = require(\"mjGameManager\");\n\tvar mjDataMgr = require(\"mjDataMgr\");\n\tvar roomInfo        = data.RoomInformation;\n\troomInfo.RoomID     = mjDataMgr.get(mjDataMgr.KEYS.ROOMID);\n\tmjDataMgr.set(mjDataMgr.KEYS.ROOMID, roomInfo.RoomID);\n    mjDataMgr.set(mjDataMgr.KEYS.ROOMINFO, roomInfo);\n    mjDataMgr.getInstance().initRoomPlayers(data.PlayersInfo);\n    for(let destPos = 0; destPos < 4; destPos++){\n    \tlet player = gameManager.playerList[destPos];\n    \tplayer.refreshData();\n    \tplayer.initPlayerStatus();\n    }\n}\n\n//在房间内重连\nReconnectMgr.inGmaeSyncData = function(paiData){\n\tcc.log(\"---//在房间内重连-----\", paiData);\n\tthis.deskPaiData = paiData.Infos;\n\tthis.setNormalPaiData();\n\tthis.startPlay();\n}\n\n\nReconnectMgr.getReportData = function(allzj){\n\tvar gameManager     = require(\"mjGameManager\");\n\tallzj = allzj || [];\n\tgameManager.gameJuCount = allzj.length;\n\tif(allzj.length < 1){return allzj}\n\tvar zhuangIndex = 0;\n\tallzj[0][zhuangIndex].isZhuangJia = true;\n\tif(allzj.length > 1){\n\t\tfor(let i=1; i<allzj.length; i++){\n\t\t\tvar lastZhuang = allzj[i-1][zhuangIndex];\n\t\t\tvar isWin  = lastZhuang.ishu || lastZhuang.iszm;\n\t\t\tif(!isWin) {\n\t\t\t\tzhuangIndex = (zhuangIndex + 1) % 4;\n\t\t\t}\n\t\t\tallzj[i][zhuangIndex].isZhuangJia = true;\n\t\t}\t\t\n\t}\n\n\treturn allzj;\n}\n\n/*--------------------- END -----IN  GameUI Reconnect -----------------*/\n\nmodule.exports = ReconnectMgr;\n"]}