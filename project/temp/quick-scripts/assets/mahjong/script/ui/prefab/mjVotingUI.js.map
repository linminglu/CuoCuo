{"version":3,"sources":["mjVotingUI.js"],"names":["mjDataMgr","require","mjNetMgr","cc","Class","extends","Component","properties","btnAgree","type","Node","default","btnAgreeLabel","btnDisagree","nameLabel","Label","onLoad","_beganFlag","hasGameBegan","string","animation","node","getComponent","Animation","clips","getClips","on","onBtnAgreeClick","onBtnDisagreeClick","onEnable","play","name","setTips","contet","log","get","KEYS","ROOMINFO","Round","exitCb","data","Leave","exiteRoom","bind","getInstance","isRoomMaster","content","roomID","ROOMID","cSend","OP","RetCode","once","destroy"],"mappings":"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","file":"mjVotingUI.js","sourceRoot":"../../../../../../../assets/mahjong/script/ui/prefab","sourcesContent":["const mjDataMgr = require(\"mjDataMgr\");\nconst mjNetMgr  = require(\"mjNetMgr\");\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        btnAgree: {\n            type: cc.Node,\n            default: null,\n        },\n\n        btnAgreeLabel: {\n            type: cc.Node,\n            default: null,\n        },\n\n        btnDisagree: {\n            type: cc.Node,\n            default: null,\n        },\n\n        nameLabel: {\n            type: cc.Label,\n            default: null,\n        },\n    },\n\n    onLoad () {\n        this._beganFlag = this.hasGameBegan();\n        if (!this._beganFlag) {\n            this.nameLabel.string = '确定退出房间？';\n            this.btnAgreeLabel.string = '确定';\n        }\n\n        this.animation = this.node.getComponent(cc.Animation);\n        this.clips = this.animation.getClips();\n\n        this.btnAgree.on('click', this.onBtnAgreeClick, this);\n        this.btnDisagree.on('click', this.onBtnDisagreeClick, this);\n    },\n\n    onEnable () {\n        this.animation.play(this.clips[0].name);\n    },\n\n    setTips(contet){\n          this.nameLabel.string = contet;\n    }, \n\n    hasGameBegan () {\n        // 获取牌局状态，已开始返回true，否则返回false\n        cc.log('---------------- round = ', mjDataMgr.get(mjDataMgr.KEYS.ROOMINFO).Round)\n        return !(mjDataMgr.get(mjDataMgr.KEYS.ROOMINFO).Round === 0)\n    },\n\n    onBtnAgreeClick () {\n        if (!this._beganFlag ) {\n            var exitCb = function(data){\n                if (data.Leave) {\n                    require(\"mjGameManager\").exiteRoom();\n                }\n            }.bind(this);\n            if(mjDataMgr.getInstance().isRoomMaster()){\n                var content    = {roomID: mjDataMgr.get(mjDataMgr.KEYS.ROOMID)}\n                mjNetMgr.cSend(\"dissolvedRoom\", content, exitCb);\n            }else {\n                mjNetMgr.cSend(\"exitOutRoom\", {},  exitCb)\n            }\n            \n        }else {\n            mjNetMgr.cSend(\"VoteOutRoom\", {OP:1}, function(data){\n                if(data.RetCode && data.RetCode !== 0){\n                }\n            }.bind(this));\n        }\n        this.onBtnDisagreeClick();\n    },\n\n    onBtnDisagreeClick () {\n        this.animation.play(this.clips[1].name).once('finished', function () {\n            this.node.destroy();\n        }, this);\n    },\n\n});\n"]}