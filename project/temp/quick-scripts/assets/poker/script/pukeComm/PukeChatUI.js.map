{"version":3,"sources":["PukeChatUI.js"],"names":["PukeDefine","require","Audio","PhoneVoice","cc","Class","extends","Component","properties","ChatBox","Prefab","Emoticon","BtnVoice","Node","interact","onLoad","sys","isNative","active","ChildNode","node","parent","getChildByName","_userInfoN","_chatEmojiQueueFunc","_chatTextQueueFunc","_isPlayChatEmoji","_isPlayChatText","i","Array","fun","event","add","onChatAck","bind","onVoiceAck","update","undefined","length","splice","onDestroy","remove","onBtnMessageClicked","playEffect","copyChatBox","instantiate","setPosition","data","self","chatFunc","seat","seato","Speaker","_sp","getComponent","sp","Skeleton","setAnimation","timeScale","scheduleOnce","dispatch","fromId","from","toId","to","func","seatNumber","SeatNumber","chatType","copyEmot","anim","animation","content","destroy","CHAT_MESSAGE_SHOW_TIME","len","interactN","wposS","convertToWorldSpaceAR","POSITION","SEAT","wposE","show","chatImg","chatContent","Label","string","getContentSize","width","setContentSize","height"],"mappings":"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","file":"PukeChatUI.js","sourceRoot":"../../../../../../assets/poker/script/pukeComm","sourcesContent":["let PukeDefine = require('PukeDefine');\nlet Audio = require('Audio');\nlet PhoneVoice = require('JSPhoneVoice');\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        ChatBox: cc.Prefab,\n        Emoticon: cc.Prefab,\n        BtnVoice: cc.Node,\n        interact: cc.Prefab\n    },\n\n    onLoad: function () {\n        if (!cc.sys.isNative) {\n            this.BtnVoice.active = false;\n        }\n        let ChildNode = this.node.parent.parent.getChildByName('childNode');\n        this._userInfoN = ChildNode.getChildByName('userinfo');\n        /*添加消息队列*/\n        this._chatEmojiQueueFunc = {};\n        this._chatTextQueueFunc = {};\n        this._isPlayChatEmoji = {};\n        this._isPlayChatText = {};\n        for (let i = 1; i <= 6; ++i) {\n            this._chatEmojiQueueFunc[i] = new Array();\n            this._chatTextQueueFunc[i] = new Array();\n            this._isPlayChatEmoji[i] = true;\n            this._isPlayChatText[i] = true;\n        }\n        fun.event.add('PukeChatUI_RoomChat', 'RoomChat', this.onChatAck.bind(this));\n        fun.event.add('PukeChatUI_Voice', 'RoomChatVoice', this.onVoiceAck.bind(this));\n    },\n\n    update: function () {\n        for (let i=1; i<=6; ++i) {\n            if (this._chatEmojiQueueFunc !== undefined\n                && this._chatEmojiQueueFunc[i] !== undefined\n                && this._chatEmojiQueueFunc[i].length > 0\n                && this._isPlayChatEmoji[i]) {\n                this._chatEmojiQueueFunc[i][0]();\n                this._chatEmojiQueueFunc[i].splice(0, 1);\n            }\n            if (this._chatTextQueueFunc !== undefined\n                && this._chatTextQueueFunc[i] !== undefined\n                && this._chatTextQueueFunc[i].length > 0\n                && this._isPlayChatText[i]) {\n                this._chatTextQueueFunc[i][0]();\n                this._chatTextQueueFunc[i].splice(0, 1);\n            }\n        }\n    },\n\n    onDestroy: function () {\n        this._chatEmojiQueueFunc = {};\n        this._chatTextQueueFunc = {};\n        this._isPlayChatEmoji = {};\n        this._isPlayChatText = {};\n        fun.event.remove('PukeChatUI_RoomChat');\n        fun.event.remove('PukeChatUI_Voice');\n    },\n\n    onBtnMessageClicked: function () {\n        Audio.playEffect('hall', 'button_nomal.mp3');\n        let copyChatBox = cc.instantiate(this.ChatBox);\n        copyChatBox.setPosition(0, 0);\n        copyChatBox.parent = this._userInfoN;\n    },\n\n    onVoiceAck: function(data){\n        let self = this;\n        let chatFunc = function(seat, seato){\n            seat.Speaker.active = true;\n            let _sp = seat.Speaker.getChildByName('sp').getComponent(sp.Skeleton);\n            _sp.setAnimation(0, \"animation\", true)\n            _sp.timeScale = 1;\n            self.scheduleOnce(function(){\n                seat.Speaker.active = false;\n                _sp.timeScale = 0;\n            }, data.length);\n        }\n        fun.event.dispatch('PukeChatUI', {fromId: data.from, toId: data.to ? data.to : null, func: chatFunc});\n    },\n\n    onChatAck: function (data) {\n        let self = this;\n        let chatFunc = function(seat, seato){\n            let seatNumber = seat.SeatNumber;\n            if (data.chatType === 'emoji') {\n                let func = function(){\n                    self._isPlayChatEmoji[seatNumber] = false;\n                    let copyEmot = cc.instantiate(self.Emoticon);\n                    copyEmot.setPosition(-83, 12);\n                    copyEmot.parent = seat;\n                    let anim = copyEmot.getComponent(sp.Skeleton);\n                    anim.animation = data.content;\n                    self.scheduleOnce(function(){\n                        copyEmot.destroy();\n                        self._isPlayChatEmoji[seatNumber] = true;\n                    }, PukeDefine.CHAT_MESSAGE_SHOW_TIME);\n                }\n                let len = self._chatEmojiQueueFunc[seatNumber].length;\n                self._chatEmojiQueueFunc[seatNumber][len] = func;\n            } else if (data.chatType === 'interact') {\n                let interactN = cc.instantiate(self.interact);\n                interactN.parent = self._userInfoN;\n                let wposS = self.node.convertToWorldSpaceAR(PukeDefine.POSITION.SEAT[seatNumber]);\n                let wposE = self.node.convertToWorldSpaceAR(PukeDefine.POSITION.SEAT[seato.SeatNumber]);\n                interactN.getComponent('interact').show(data, wposS, wposE);\n            } else if (data.chatType === 'text') {\n                let func = function(){\n                    self._isPlayChatText[seatNumber] = false;\n                    let chatImg = seat.getChildByName(\"chatImg\");\n                    chatImg.active = true;\n                    let chatContent = chatImg.getChildByName(\"content\");\n                    chatContent.getComponent(cc.Label).string = data.content;\n                    let length = chatContent.getContentSize().width;\n                    chatImg.setContentSize(length + 30, chatImg.getContentSize().height);\n                    self.scheduleOnce(function(){\n                        chatImg.active = false;\n                        self._isPlayChatText[seatNumber] = true;\n                    }, PukeDefine.CHAT_MESSAGE_SHOW_TIME);\n                }\n                let len = self._chatTextQueueFunc[seatNumber].length;\n                self._chatTextQueueFunc[seatNumber][len] = func;\n            }\n        }\n        fun.event.dispatch('PukeChatUI', {fromId: data.from, toId: data.to ? data.to : null, func: chatFunc});\n    }        \n});\n"]}