{"version":3,"sources":["PukeDisband.js"],"names":["cc","Class","extends","Component","properties","applicantTabel","RichText","PlayerList","Node","TimeLabel","Label","BtnAgree","BtnDisagree","update","dt","isUpdate","time","parseInt","string","node","active","dtTime","newTime","disbandRoomInit","data","UserInfo","fun","db","getData","MineUserId","UserId","setBtnAgreeActive","setPlayerActive","GameType","net","pSend","rsp","Now","NewBeginTime","EndTime","initSanGongShow","bind","timeBreak","initNiuNiuShow","i","children","length","allAgreeDisband","player","getChildByName","ok","count","id","VoteInfo","info","name","state","icon","utils","loadUrlRes","headUrl","getComponent","no","applyStatu","onBtnAgreeClicked","send","OP","onBtnDisagreeClicked"],"mappings":"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","file":"PukeDisband.js","sourceRoot":"../../../../../../assets/poker/script/prefab","sourcesContent":["cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        applicantTabel : cc.RichText,\r\n        PlayerList     : cc.Node,\r\n        TimeLabel      : cc.Label,\r\n        BtnAgree       : cc.Node,\r\n        BtnDisagree    : cc.Node,\r\n    },\r\n\r\n    update: function (dt) {\r\n        if (this.isUpdate) {\r\n            let time = parseInt(this.TimeLabel.string);\r\n            if (time <= 0) {\r\n                this.isUpdate = false;\r\n                this.node.active = false;\r\n            } else {\r\n                this.dtTime = (this.dtTime || 0) + dt;\r\n                if (this.dtTime >= 1) {\r\n                    this.dtTime -= 1;\r\n                    let newTime = time - 1;\r\n                    this.TimeLabel.string = newTime <= 0 ? 0 : newTime;\r\n                }\r\n            }\r\n        }\r\n    },\r\n\r\n    disbandRoomInit : function(data){\r\n        this.data = data;\r\n        let UserInfo = fun.db.getData('UserInfo');\r\n        this.MineUserId = parseInt(UserInfo.UserId);\r\n        this.isUpdate = true;\r\n        this.setBtnAgreeActive(false);\r\n        this.setPlayerActive();\r\n\r\n        if (data.GameType === 'sangong') { //三公\r\n            fun.net.pSend('ServerTime', '', function(rsp){\r\n                if (rsp.Now) {\r\n                    this.NewBeginTime = rsp.Now;\r\n                    this.TimeLabel.string = data.EndTime - this.NewBeginTime;\r\n                    this.initSanGongShow();\r\n                }\r\n            }.bind(this));\r\n        } else if (data.GameType === 'niuniu') { //牛牛\r\n            if (data.timeBreak) {\r\n                this.TimeLabel.string = data.timeBreak;\r\n            }\r\n            this.initNiuNiuShow();\r\n        }\r\n    },\r\n\r\n    setBtnAgreeActive : function (active) {\r\n        this.BtnAgree.active    = active;\r\n        this.BtnDisagree.active = active;\r\n    },\r\n\r\n    setPlayerActive : function (active) {\r\n        for (let i = 0; i < this.PlayerList.children.length; ++i) {\r\n            this.PlayerList.children[i].active = false;\r\n        }\r\n    },\r\n\r\n    allAgreeDisband : function () {\r\n        for (let i=1; i<=6; ++i) {\r\n            let player = this.PlayerList.getChildByName('player_'+i);\r\n            let ok = player.getChildByName('ok').getChildByName('tag');\r\n            ok.active = true;\r\n        }\r\n    },\r\n\r\n    initSanGongShow : function () {\r\n        let count = 0;\r\n        for (let id in this.data.VoteInfo) {\r\n            count++;\r\n            let info = this.data.VoteInfo[id];\r\n            info.name = info.name === 'gust' ? info.name + id : info.name;\r\n            if (parseInt(id) === this.MineUserId && info.state === 0) {\r\n                this.setBtnAgreeActive(true);\r\n            }\r\n            let player = this.PlayerList.getChildByName('player_'+count);\r\n            player.active = true;\r\n            let icon = player.getChildByName('icon').getChildByName('img');\r\n            fun.utils.loadUrlRes(info.headUrl, icon);\r\n            let name = player.getChildByName('name').getComponent(cc.Label);\r\n            name.string = info.name;\r\n            let ok = player.getChildByName('ok').getChildByName('tag');\r\n            let no = player.getChildByName('no').getChildByName('tag');\r\n            if (info.state === 0) { //准备\r\n                ok.active = false;\r\n                no.active = false;\r\n            } else if (info.state === 1) { //申请\r\n                ok.active = true;\r\n                no.active = false;\r\n                this.applicantTabel.string = '玩家' + info.name + '申请退出游戏，请投票'\r\n            } else if (info.state === 2) { //同意\r\n                ok.active = true;\r\n                no.active = false;\r\n            } else if (info.state === 3) { //拒绝\r\n                ok.active = false;\r\n                no.active = true;\r\n            }\r\n        }\r\n    },\r\n\r\n    initNiuNiuShow : function () {\r\n        let count = 0;\r\n        for (let id in this.data.applyStatu) {\r\n            count++;\r\n            let info = this.data.applyStatu[id];\r\n            info.name = info.name === 'gust' ? info.name + id : info.name;\r\n            if (parseInt(id) === this.MineUserId && info.state === 3) {\r\n                this.setBtnAgreeActive(true);\r\n            }\r\n            let player = this.PlayerList.getChildByName('player_'+count);\r\n            player.active = true;\r\n            let icon = player.getChildByName('icon').getChildByName('img');\r\n            fun.utils.loadUrlRes(info.headUrl, icon);\r\n            let name = player.getChildByName('name').getComponent(cc.Label);\r\n            name.string = info.name;\r\n            let ok = player.getChildByName('ok').getChildByName('tag');\r\n            let no = player.getChildByName('no').getChildByName('tag');\r\n            if (info.state === 3) { //准备\r\n                ok.active = false;\r\n                no.active = false;\r\n            } else if (info.state === 0) { //申请\r\n                ok.active = true;\r\n                no.active = false;\r\n                this.applicantTabel.string = '玩家' + info.name + '申请退出游戏，请投票'\r\n            } else if (info.state === 1) { //同意\r\n                ok.active = true;\r\n                no.active = false;\r\n            } else if (info.state === 2) { //拒绝\r\n                ok.active = false;\r\n                no.active = true;\r\n            }\r\n        }\r\n    },\r\n\r\n\r\n    onBtnAgreeClicked : function () {\r\n        if (this.data.GameType === 'niuniu') {\r\n            fun.net.send(\"NiuDisbandRoomVote\", { applyStatu : 1 });\r\n        } else if (this.data.GameType === 'sangong') {\r\n            fun.net.send(\"DisbandRoomVote\", { OP : 2 });\r\n        }\r\n        this.setBtnAgreeActive(false);\r\n    },\r\n\r\n    onBtnDisagreeClicked : function () {\r\n        if (this.data.GameType === 'niuniu') {\r\n            fun.net.send(\"NiuDisbandRoomVote\", { applyStatu : 2 });\r\n        } else if (this.data.GameType === 'sangong') {\r\n            fun.net.send(\"DisbandRoomVote\", { OP : 3 });\r\n        }\r\n        this.setBtnAgreeActive(false);\r\n    },\r\n});\r\n"]}